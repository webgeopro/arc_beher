function VideoMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10" atom-file><video controls height="200" style="display: block; margin-bottom: 10px;" data-ng-if="form.'+e.name+'[0].route"><source data-ng-src="{{form.'+e.name+'[0].route}}" type=\'video/mp4; codecs="avc1.42E01E, mp4a.40.2"\'/></video><input data-file-upload '+t+' id="'+e.name+'" ng-model="form.'+e.name+'" name="'+e.name+'" type="file" title="Выберите файл"  class="ng-hide"><a class="file-input-wrapper btn btn-default  btn-primary" ><span>Выберите видеофайл</span></a><a style="margin-left: 5px;" ng-if="form.'+e.name+'[0].route" class="btn btn-default btn-primary" href="{{form.'+e.name+'[0].route}}"><span>Скачать видеофайл</span></a></div>',callback:function(e){return!0}}}function UrlMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><div class="input-group"><span class="input-group-addon">{{form.'+e.name+".urlPrefix}}</span><input "+t+i+' id="'+e.name+'"  type="text" class="form-control" data-ng-model="form.'+e.name+'.displayUrl"></div></div>',callback:function(e){return!0}}}function TextareaMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",{markup:'<label for="textarea-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+i+' id="textarea-'+e.name+'" class="form-control" rows="4" placeholder="'+e.placeholder+'" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function TextMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder||"",{markup:'<label for="text-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+i+' autocomplete="off" id="text-'+e.name+'" placeholder="'+e.placeholder+'" class="form-control" rows="4" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function StringMarkup(e){var t=Boolean(e.multiple),i="undefined"!=typeof e.disabled&&1==e.disabled?" readonly ":" ",n="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",t?{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><div class="row" ng-repeat="formItem in form.'+e.name+' track by $index"><div class="col-sm-9"><input '+i+n+' autocomplete="off" id="form.'+e.name+'[{{$index}}]" placeholder="'+e.placeholder+'" style="margin-bottom: 5px"type="text" class="form-control" data-ng-model="form.'+e.name+'[$index]"ng-keypress="($event.which === 13)?pushMultipleStringElement(\''+e.name+'\', $index):0"></div><div class="col-sm-3"><div class="btn-group" role="group"><button tooltip-append-to-body="true" uib-tooltip="�������� ����" class="btn btn-default" ng-disabled="$index == form.'+e.name+'.length - 1" ng-click="moveMultipleStringElement(\''+e.name+'\', $index, $index + 1)"><i class="fa fa-chevron-down"></i></button><button tooltip-append-to-body="true" uib-tooltip="������� ����" class="btn btn-default" ng-disabled="!$index" ng-click="moveMultipleStringElement(\''+e.name+'\', $index, $index - 1)"><i class="fa fa-chevron-up"></i></button></div> <div class="btn-group" role="group"><button tooltip-append-to-body="true" uib-tooltip="������� �������" class="btn btn-default" ng-click="removeMultipleStringElement(\''+e.name+'\', $index)"><i class="fa fa-minus"></i></button><button tooltip-append-to-body="true" uib-tooltip="�������� �����" class="btn btn-default" ng-click="insertMultipleStringElement(\''+e.name+'\', $index)"><i class="fa fa-plus"></i></button></div></div></div></div>',callback:function(e){return!0}}:{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><input '+i+n+' autocomplete="off" id="'+e.name+'" placeholder="'+e.placeholder+'" type="text" class="form-control" data-ng-model="form.'+e.name+'"></div>',callback:function(e){return!0}}}function SpeedMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="select-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><span ><select '+t+' class="chosen-select" data-ng-options="o for  o in speedList" data-ng-model="form.'+e.name+'"></select></span></div>',callback:function(e){return setTimeout(function(){jQuery(".chosen-select").chosen({})},500),!0}}}function SlidesMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:['<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+"</label>",'<div class="col-sm-10 slides-item" data-ng-class="{\'pull-right\': $index > 0}" data-ng-repeat="tileSlid in form.'+e.name+'">',"<input "+t+' type="file" data-index="{{$index}}" title="Выберите файл"   onchange="angular.element(this).scope().changeFile(this)"  data-file-upload class="btn-primary" data-ng-model="tileSlid.path">','<img class="image-link" data-ng-if="tileSlid.route" style="width:30px; margin-left: 18px;" data-ng-src="{{tileSlid.route}}"/>','<img class="image-link" data-ng-if="!tileSlid.route" style="width:30px; margin-left: 18px;" data-ng-src="http://placehold.it/30x30"/>','<label  title="Видимость" class="switch" style="position: relative; top: 10px; left: 10px; margin-right: 10px;"><input data-ng-model="tileSlid.status"  type="checkbox" ><i></i></label>','<a data-ng-hide="$first" data-ng-click="remTileSlide($index);" title="Удалить" href="javascript:;" style="margin-left: 10px;" class="btn-icon btn-icon-sm bg-danger"><i class="glyphicon glyphicon-minus"></i></a>','<a data-ng-show="$last" data-ng-click="addTileSlide();" title="Добавить" href="javascript:;" style="margin-left: 10px; " class="btn-icon btn-icon-sm bg-info"><i class="glyphicon glyphicon-plus"></i></a>',"</div>"].join(""),callback:function(e){return!0}}}function SelectMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?"disabled":"";return{markup:'<label for="select-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><select '+t+' chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" ng-options="option.name for option in  optionsData.'+e.name+'.options " id="select-'+e.name+'.val" ng-model="form.'+e.name+'"></select></div>',callback:function(e){return setTimeout(function(){"disabled"===t&&jQuery(e).find("[chosen]").prop("disabled",!0).trigger("chosen:updated")},500),!0}}}function PasswordMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><atom-password ><div class="input-group"><input '+t+i+' id="'+e.name+'"  autocomplete="off" type="{{atomPassword.type}}" class="form-control" data-ng-model="form.'+e.name+'"><span class="input-group-addon" ng-click="atomPassword.generatePassword()"><i class="glyphicon glyphicon-flash"></i></span></div></atom-password></div>',callback:function(e){return!0}}}function NumericMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return e.placeholder=e.placeholder?e.placeholder:"",{markup:'<label for="number-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><input '+t+i+' id="number-'+e.name+'" placeholder="'+e.placeholder+'"  data-ng-model="form.'+e.name+'"  type="number" class="form-control"></div>',callback:function(e){return e=e.find(".input-group"),e.find(".input-group-btn  button").click(function(){setTimeout(function(){e.find("input.spinner-input").trigger("change")},300)}),!0}}}function MarkupFactory(e){if(e){"datetime"!==e&&"time"!==e||(e="date"),e=e.split("-"),angular.forEach(e,function(t,i){var n=t.charAt(0).toUpperCase();e[i]=n+t.substr(1,t.length-1)});var t=e.join("")+"Markup";return t}}function IntegerMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="number-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><input '+t+i+' id="number-'+e.name+'" data-ng-model="form.'+e.name+'"  type="number" class="form-control"></div>',callback:function(e){return e=e.find(".input-group"),e.find(".input-group-btn  button").click(function(){setTimeout(function(){e.find("input.spinner-input").trigger("change")},300)}),!0}}}function ImgMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><input '+t+' id="'+e.name+'" type="file" title="Выберите файл"   onchange="angular.element(this).scope().changeFile(this)"  data-file-upload class="btn-primary" data-ng-model="form.'+e.name+'"><img class="image-link" data-ng-if="form.'+e.name+'" style="height:30px; margin-left: 18px;" data-ng-src="{{form.'+e.name+'}}"/></div>',callback:function(e){return!0}}}function ImageMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><span atom-file><input '+t+' id="'+e.name+'" name="'+e.name+'" type="file" title="Выберите файл"  class="ng-hide">'+(e.readonly?"":'<a class="file-input-wrapper btn btn-default btn-primary" ><span>Выберите файл</span></a>')+'<img class="image-link" data-ng-if="form.'+e.name+'[0].route" style="height:30px; margin-left: 18px;" ng-click="openLightboxModal($event)" data-ng-src="{{form.'+e.name+'[0].route}}"/></span><a target="_blank" ng-if="form.'+e.name+'[0].route" href="{{form.'+e.name+'[0].route}}" class="btn btn-default btn-primary" style="margin-left: 10px" ><span>Скачать файл</span></a></div>',callback:function(e){return!0}}}function HtmlMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled?" disabled ":" ",i="undefined"!=typeof e.readonly&&1==e.readonly?" readonly ":" ";return{markup:'<label for="textarea-'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><textarea '+t+i+' id="textarea-'+e.name+'" data-ui-tinymce class="form-control" rows="4" data-ng-model="form.'+e.name+'"></textarea></div>',callback:function(e){return!0}}}function FileMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><span atom-file><input data-file-upload '+t+' id="'+e.name+'" ng-model="form.'+e.name+'" name="'+e.name+'" type="file" title="Выберите файл"  class="ng-hide">'+(e.readonly?"":'<a class="file-input-wrapper btn btn-default btn-primary" ><span>Выберите файл</span></a>')+'</span><a target="_blank" ng-if="form.'+e.name+'[0].route" href="{{form.'+e.name+'[0].route}}" class="btn btn-default btn-primary" style="margin-left: 10px" ><span>Скачать файл</span></a></div>',callback:function(e){return!0}}}function EntityMarkup(e){var t=e.multiple===!0?" multiple ":" ",i="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?"disabled":" ";return{markup:'<div class="col-sm-2"><label for="select-'+e.name+'" style="margin-top: 7px;">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+"</label><a ng-if=\"selectedEntity('"+e.name+'\')" href="javascript:void(0)" ng-click="openEntity(\''+e.name+"',"+e.multiple+')" ><i  tooltip="Открыть в новом окне связанные элементы" tooltip-placement="top" tooltip-append-to-body="true" class="fa fa-share entity-link '+t+'" style="margin-top: 7px;"></i></a></div><div class="col-sm-10"><span ><select '+i+' chosen="{disableSearch: true}" disable-search no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" class="form-control"  '+t+' entity-markup ng-options="option as option.name for option in  ::options track by option.id" id="select-'+e.name+'.val" ng-model="form.'+e.name+'"></select></span></div>',callback:function(e){return setTimeout(function(){"disabled"===i&&jQuery(e).find("[chosen]").prop("disabled",!0).trigger("chosen:updated")},500),!0}}}function DateMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly;return{markup:['<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+"</label>",'<div readonly="'+t+'" class="input-group col-sm-4" style="padding: 0 15px;" m-model="form.'+e.name+'.sec" ng-model="form.'+e.name+'.sec" atom-datetimepicker language="ru" form="form" data-data-type="'+e.type+'" data-data-name="'+e.name+'" >',"</div>"].join(""),callback:function(e){return!0}}}function BooleanMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><label class="switch"><input '+t+' id="'+e.name+'"  type="checkbox" data-ng-model="form.'+e.name+'" ><i></i></label></div>',callback:function(e){return!0}}}function AclMarkup(e){var t="undefined"!=typeof e.disabled&&1==e.disabled||e.readonly?" disabled ":" ";return{markup:'<label for="'+e.name+'" class="col-sm-2">'+e.title+(e.require?'<span class="require" style="padding-left: 3px;">*</span>':"")+'</label><div class="col-sm-10"><div class="table-responsive"><table class="table table-striped table-bordered" acl-markup'+t+'><thead><tr><th>#</th><th width="15%">Чтение</th><th width="15%">Создание</th><th width="15%">Редактирование</th><th width="15%">Удаление</th></tr></thead><tbody><tr ng-repeat="option in optionsData.'+e.name+'.options"><td>{{option.title}}</td><td><label class="switch"><input id="read_{{ option.key }}"  type="checkbox" data-ng-model="option.read" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\' && option.key != \'log\' && option.key != \'crm\'"><input id="create_{{ option.key }}"  type="checkbox" data-ng-model="option.create" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\' && option.key != \'log\' && option.key != \'crm\'"><input id="update_{{ option.key }}"  type="checkbox" data-ng-model="option.update" ><i></i></label></td><td><label class="switch" ng-show="option.key != \'index\' && option.key != \'atom\' && option.key != \'log\' && option.key != \'crm\'"><input id="delete_{{ option.key }}"  type="checkbox" data-ng-model="option.delete" ><i></i></label></td></tr></tbody></table></div></div>',callback:function(e){return!0}}}!function(){"use strict";angular.module("entityPage",[]).config(["$stateProvider",function(e){e.state("pagesList",{url:"/page/list",views:{"content@":{templateUrl:"app/modules/entityPage/pagesList/pagesList.html",controller:"PagesListCtrl"}}}).state("entitiesList",{url:"/:entity/list",views:{"content@":{templateUrl:"app/modules/entityPage/entitiesList/entitiesList.html",controller:"EntitiesListCtrl"}}}).state("entityEdit",{url:"/:entity/edit/:id",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}}).state("entityAdd",{url:"/:entity/add",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}}).state("entityAddPage",{url:"/:entity/add/:pid",views:{"content@":{templateUrl:"app/modules/entityPage/entityEdit/entityEdit.html",controller:"EntityEditCtrl"}}})}])}(),function(){"use strict";angular.module("entityPage").controller("PagesListCtrl",["$q","$log","$scope","$stateParams","$state","$location","EntityService","$uibModal","toastr","_",function(e,t,i,n,a,o,l,s,r,c){function d(e,t,i){return c.each(e,function(t){if(0!==t._id.$id){var i="undefined"!=typeof t.pid.$id?t.pid.$id:t.pid;e[i].items.push(t),e[i].items.sort(function(e,t){return e.position-t.position})}}),t}var u={};i.list=[];var p=[];i.options={dropped:function(t){function n(e){c.each(e.items,function(t){var i=t.url.split("/");t.url=e.url+i[i.length-2],a.push({_id:t._id.$id,position:t.position,pid:t.pid.$id,url:t.url}),n(t)})}var a=[],o=[],s=t.source.nodeScope.$modelValue,d=t.dest.index,m=t.source.index,f=t.dest.nodesScope.$nodeScope.$modelValue,g=t.source.nodesScope.$nodeScope.$modelValue;if(d!==m||f._id.$id!==g._id.$id){var h;h=0===s.pid?0:s.pid.$id,c.each(u[h].items,function(e){o.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url})}),s.pid=f._id,c.each(u[s.pid.$id].items,function(e,t){o.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url}),e.position=t;var i=e.url.split("/");e.url=f.url+i[i.length-2]+"/",a.push({_id:e._id.$id,position:e.position,pid:e.pid.$id,url:e.url}),n(e)});var y=[];c.each(a,function(e){y.push(l.saveEntity("page",e,!1,!1))}),e.all(y).then(function(e){var t=!0;c.each(e,function(e){t=t||e.data.success}),t&&(r.success("Изменения успешно сохранены"),p=c.clone(i.data))},function(t){c.each(t.data.error,function(e){c.each(e,function(e){r.error(e.message)})});var n=[];c.each(o,function(e){n.push(l.saveEntity("page",e,!1,!1))}),e.all(n).then(function(e){i.data=p})})}}},l.getEntityDescription("page").then(function(e){l.getEntityPage("page",0,0).then(function(t){c.each(t.data.data,function(e){e.items=[],u[e._id.$id]=e});var n={_id:{$id:0},items:[],title:o.host(),url:"/",isRoot:!0};u[0]=n,n=d(u,n,0),i.data=[n],p=c.clone(i.data),i.list.scheme=e.data.page.scheme})}),i.removeItem=function(e,t){var i=e._id.$id,n=e.title,a=s.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(o){o.title=n,o.message="Вы действительно хотите удалить данный элемент?",o.ok=function(){a.close(),l.removeEntity("page",{_id:i}).then(function(){r.success("Запись успешно удалена")}),t(e)},o.cancel=function(){a.dismiss("cancel")}}]})},i.toggle=function(e){e.collapsed=!e.collapsed},i.hoverIn=function(){this.hovered=!0},i.hoverOut=function(){this.hovered=!1}}])}(),function(){"use strict";angular.module("entityPage").controller("EntityEditCtrl",["$scope","$state","$stateParams","$uibModal","$window","$q","$timeout","EntityService","AuthService","_","uiTinymceConfig","toastr","$cookies",function(e,t,i,n,a,o,l,s,r,c,d,u,p){function m(){0!==angular.element(".mce-container.mce-panel.mce-floatpanel.mce-window.mce-in:eq(1)").length&&l(function(){var e=angular.element(window).width()-30;e>1270&&(e=1270),angular.element(".mce-container.mce-panel.mce-floatpanel.mce-window.mce-in:eq(1)").css("width",e).css("left",15),angular.element(".mce-container-body.mce-window-body.mce-abs-layout:eq(1)").css("width","100%")},250)}var f={};e.form={},e.entity=i.entity,e.isNew=!i.id,e.itemTitle="",a.jQuery.ajaxSetup({beforeSend:function(e){e.setRequestHeader("Token",p.get("token"))}}),d=c.extend(d,{height:300,menubar:!1,language:"ru",plugins:["code,table advlist autolink link image lists charmap print preview hr anchor pagebreak ","searchreplace wordcount visualblocks visualchars insertdatetime media nonbreaking"," contextmenu directionality emoticons paste textcolor responsivefilemanager"],convert_urls:!1,relative_urls:!0,toolbar1:"formatselect | bold italic underline | alignleft aligncenter alignright alignjustify | outdent indent | bullist numlist | table | styleselect| link unlink filemanager | image media | code ",valid_elements:"*[*]",image_advtab:!0,external_filemanager_path:"/atom/filemanager/",external_plugins:{filemanager:"/themes/backend/filemanager/plugin.min.js"},filemanager_title:"Файловый менеджер"}),angular.element(window).resize(m),o.all([r.properties(),s.getEntityDescription(i.entity)]).then(function(t){function n(){var t="undefined"==typeof e.backend.tabs.main?"default":"main";return"default"===t&&(e.backend.tabs[t]="Основное",u[t]="Основное"),t}var a=t[1],o=t[0].data.entities[i.entity];e.updateEnabled="undefined"!=typeof a.data[i.entity].routes[i.entity+".update"],e.createEnabled="undefined"!=typeof a.data[i.entity].routes[i.entity+".create"],e.deleteEnabled="undefined"!=typeof a.data[i.entity].routes[i.entity+".delete"];var r=a.data[i.entity].scheme;e.backend={},e.backend.tabs=o.tabs||{};var d=function(){angular.element('a:contains("Unlicensed Froala Editor")').remove()};d(),l(d,300),l(d,500),l(d,700),l(d,1e3),l(d,1300);var u={};c.each(r,function(t){"undefined"==typeof t.tab&&(t.tab=n()),"undefined"==typeof e.backend.tabs[t.tab]&&(e.backend.tabs[t.tab]=t.tab)}),c.each(e.backend.tabs,function(t,i){c.each(r,function(t){t.tab===i&&(u[t.tab]=e.backend.tabs[t.tab])})}),e.tabsCount=c.keys(u).length,e.tabs=u,i.id?s.getEntity(i.entity,i.id).then(function(t){e.form={},e.optionsData={};try{Object.keys(r).forEach(function(e){"string"==r[e].type&&r[e].multiple&&t.data.data[0][e]&&-1!==t.data.data[0][e].indexOf(",")&&angular.isString(t.data.data[0][e])?(t.data.data[0][e]=t.data.data[0][e].split(","),t.data.data[0][e].length||t.data.data[0][e].push("")):"string"==r[e].type&&r[e].multiple&&t.data.data[0][e]&&angular.isString(t.data.data[0][e])?t.data.data[0][e]=[t.data.data[0][e]]:"string"==r[e].type&&r[e].multiple&&!t.data.data[0][e]&&(t.data.data[0][e]=[""])})}catch(i){throw i}c.each(r,function(i,n){"select"==i.type||"entity"==i.type||"acl"==i.type?(e.optionsData[n]=i,e.optionsData[n].options=[],e.form[n]=i.multiple?[]:null,"select"==i.type?c.each(i.values,function(a,o){var l={name:a,id:o};e.optionsData[n].options.push(l),o==t.data.data[0][n]&&(i.multiple?e.form[n].push(l):e.form[n]=l)}):e.optionsData[n].sourceValues=t.data.data[0][n]):e.form[n]=t.data.data[0][n],i.name=n}),e.formSchema=r,c.each(e.formSchema,function(i,n){if("undefined"==typeof e.form[n]?e.form[n]=i["default"]:"undefined"==typeof e.form[n]&&"select"==i.type&&c.each(i.values,function(a,o){var l={name:a,id:o};e.optionsData[n].options.push(l),o==t.data.data[0][n]&&(i.multiple?e.form[n].push(l):e.form[n]=l)}),"url"==i.type){var a=e.form[n],o=(e.form.title,a.split("/")),l=a.substring(0,a.length-o[o.length-2].length-1),s=o[o.length-2];e.form[n]={urlPrefix:l,displayUrl:s}}}),f=c.clone(e.form),e.itemTitle=e.form.title}):(e.optionsData={},c.each(r,function(t,i){"boolean"===t.type?"undefined"!=typeof t["default"]?e.form[i]=t["default"]:e.form[i]=!1:"string"===t.type&&t.multiple?"undefined"!=typeof t["default"]?e.form[i]=t["default"]:e.form[i]=[""]:"entity"===t.type||"select"===t.type||"acl"==t.type?(e.optionsData[i]=t,e.optionsData[i].options=[],e.optionsData[i].sourceValues={},e.form[i]=t.multiple?[]:null,"select"==t.type&&c.each(t.values,function(n,a){var o={name:n,id:a};e.optionsData[i].options.push(o),o.id==t["default"]&&(t.multiple?e.form[i].push(o):e.form[i]=o)})):"undefined"==typeof t["default"]?e.form[i]=null:e.form[i]=t["default"],t.name=i}),i.pid?"0"===i.pid?(e.form.url={urlPrefix:"/",displayUrl:""},e.optionsData.pid=r.pid,e.optionsData.pid.sourceValues={$id:"0"},e.formSchema=r,f=c.clone(e.form)):s.getEntity(i.entity,i.pid).then(function(t){e.form.url={urlPrefix:t.data.data[0].url,displayUrl:""},e.optionsData.pid=r.pid,e.optionsData.pid.sourceValues=t.data.data[0]._id,e.formSchema=r,f=c.clone(e.form)}):(e.formSchema=r,f=c.clone(e.form)))}),e.save=function(t){i.id&&(e.form._id=i.id);var n={},o=!!c.findWhere(e.formSchema,{type:"image"})||!!c.findWhere(e.formSchema,{type:"file"}),l=new a.FormData;Object.keys(e.form).forEach(function(t){var i=e.form[t];("_id"==t||"undefined"!=typeof i&&null!==i||"acl"===e.formSchema[t].type)&&("_id"==t||"entity"!=e.formSchema[t].type&&"select"!=e.formSchema[t].type?"_id"!=t&&"acl"==e.formSchema[t].type?c.each(e.formSchema[t].options,function(e,i){n[t+"["+e.key+"][read]"]=e.read||!1,n[t+"["+e.key+"][create]"]=e.create||!1,n[t+"["+e.key+"][update]"]=e.update||!1,n[t+"["+e.key+"][delete]"]=e["delete"]||!1}):"_id"!=t&&"image"==e.formSchema[t].type?i&&i.updateFile&&l.append(t,i):"_id"!=t&&"file"==e.formSchema[t].type?i&&i.updateFile&&l.append(t,i):"_id"!=t&&"url"==e.formSchema[t].type?(i=e.form[t].urlPrefix+e.form[t].displayUrl+"/",n[t]=i,l.append(t,i)):"_id"!=t&&"string"==e.formSchema[t].type?e.formSchema[t].multiple?c.each(i,function(e,i){n[t+"["+i+"]"]=e,l.append(t+"["+i+"]",e)}):i&&(n[t]=i,l.append(t,i)):(n[t]=i,l.append(t,i)):e.formSchema[t].multiple?c.each(i,function(e,i){n[t+"["+i+"]"]=e.id,l.append(t+"["+i+"]",e.id)}):i&&"undefined"!=typeof i.id&&(l.append(t,i.id),n[t]=i.id))}),s.saveEntity(i.entity,o?l:n,e.isNew,o).then(function(i){i.data.success&&(u.success("Запись успешно сохранена"),t?e.goToList():e.goToEdit(c.keys(i.data.success[0])))},function(e){c.each(e.data.error,function(e){c.each(e,function(e){u.error(e.message)})})})},e.moveMultipleStringElement=function(t,i,n){if(n>=e.form[t].length)for(var a=n-e.form[t].length;a--+1;)e.form[t].push(void 0);e.form[t].splice(n,0,e.form[t].splice(i,1)[0]),angular.element('input[id="form.'+t+"["+n+']"]')[0].focus()},e.pushMultipleStringElement=function(e,t){},e.insertMultipleStringElement=function(t,i){e.form[t].splice(i+1,0,""),l(function(){angular.element('input[id="form.'+t+"["+(i+1)+']"]')[0].focus()},50)},e.removeMultipleStringElement=function(t,i){e.form[t].splice(i,1),e.form[t].length||e.form[t].push("")},e.remove=function(){var a=e.form.title||null,o=n.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(e){e.title=a,e.message="Вы действительно хотите удалить данный элемент?",e.ok=function(){o.close(),s.removeEntity(i.entity,{_id:i.id}).then(function(){u.success("Запись успешно удалена"),t.go("entitiesList",{entity:i.entity})})},e.cancel=function(){o.dismiss("cancel")}}]})},e.clear=function(){for(var t in e.form)e.form[t]=null},e.rollback=function(){e.form=c.clone(f)},e.goToList=function(){t.go("page"===i.entity?"pagesList":"entitiesList",{entity:i.entity})},e.goToEdit=function(e){t.go("entityEdit",{entity:i.entity,id:e})},e.openEntity=function(i,n){var o=e.form[i];if(0!==o.length){var l;void 0===n||0==n?(l=t.href("entityEdit",{entity:e.formSchema[i].entity.model,id:o.id},{absolute:!1}),a.open(location.origin+location.pathname+l)):c.each(o,function(n){l=t.href("entityEdit",{entity:e.formSchema[i].entity.model,id:n.id},{absolute:!1}),a.open(location.origin+location.pathname+l)})}},e.selectedEntity=function(t){return null!==e.form[t]&&0!=e.form[t].length}}])}(),function(){"use strict";angular.module("entityPage").controller("EntitiesListCtrl",["$log","$q","$scope","$stateParams","$state","$timeout","EntityService","$uibModal","toastr","_","SessionService","deviceDetector","HelperService",function(e,t,i,n,a,o,l,s,r,c,d,u,p){function m(e,t){var i="";return c.find(e,function(e,n){return i=n,"entity"===e.type&&e.entity.model===t}),i}function f(){o(function(){var e=!1;e="safari"==u.browser?angular.element("#content div.panel-body").outerWidth()>angular.element("section.table-flip-scroll").width():angular.element("#content table").width()>angular.element("section.table-flip-scroll").width(),e&&(angular.element("section.panel div.panel-body").css("max-height",angular.element(window).height()-(angular.element("#header").height()+(angular.element("div.page").innerHeight()-angular.element("div.page").height()-110)+angular.element("div.panel-heading").outerHeight(!0)+angular.element("div.table-filters").outerHeight(!0)+angular.element("footer.table-footer").outerHeight(!0))+"px"),angular.element("section.panel div.panel-body table, section.panel div.panel-body section").css("max-height",angular.element(window).height()-(angular.element("#header").height()+(angular.element("div.page").innerHeight()-angular.element("div.page").height()-110)+angular.element("div.panel-heading").outerHeight(!0)+angular.element("div.table-filters").outerHeight(!0)+angular.element("footer.table-footer").outerHeight(!0))-20+"px"))},500)}function g(e){h.searchKeywords=i.searchKeywords,d.setEntityListState(h,n.entity),i.displayData(0,i.perPage,i.curSortField,i.curSortOrder,i.searchKeywords,e)}if("page"==n.entity)return void a.go("pagesList");var h=d.getEntityListState(n.entity)||{};i.$log=e,i.list={},i.model=n.entity,i.remList=[],i.linkedEntities={},i.fieldsInTable={},i.pageFilter={},i.onceSelected={},i.$on("filter:applied",function(e,t){(t.value||t.secondaryValue||0===t.value||0===t.secondaryValue||t.value===!1)&&(i.searchKeywords="",h.searchKeywords=i.searchKeywords,d.setEntityListState(h,n.entity),i.filtered=!0,i.pageFilter[t.fieldName]=t,g(i.pageFilter))}),i.editMode={};var y=[],v=!1,b=[],k=!0,w={};i.curSortField=h.curSortField,i.curSortOrder=h.curSortOrder,i.searchKeywords=h.searchKeywords,i.hasSearchFields=!1,i.order=function(e,t){i.curSortField=e,i.curSortOrder=t,y=[],i.remList=[],h.curSortField=e,h.curSortOrder=t,d.setEntityListState(h,n.entity),i.displayData(0,i.perPage,i.curSortField,i.curSortOrder,i.searchKeywords)},l.getEntityDescription(n.entity).then(function(e){i.exportEnabled="undefined"!=typeof e.data[n.entity].routes[n.entity+".export"],i.createEnabled="undefined"!=typeof e.data[n.entity].routes[n.entity+".create"],i.deleteEnabled="undefined"!=typeof e.data[n.entity].routes[n.entity+".delete"],i.editEnabled="undefined"!=typeof e.data[n.entity].routes[n.entity+".update"],i.graphicsEnabled="undefined"!=typeof e.data[n.entity].atomgraphics;var t=e.data[n.entity].scheme;p.getLinkedEntities(t,k).then(function(e){c.each(e,function(e){var i=m(t,e.entity);w[i]=c.map(e.data.data,function(e){return{$id:e._id.$id,title:e[t[i].entity.field]}})}),i.linkedEntities=w}).then(function(){for(var e in t)t[e].sort&&(b.push(e),"enabled"!==e&&(i.fieldsInTable[e]=t[e])),t[e].search&&(i.hasSearchFields=!0);i.list.scheme=t})}),i.displayData=function(e,t,a,s,r,c){i.renderData=null,l.getEntityPage(n.entity,e,t,a,s,r,b,c).then(function(e){if(v=!1,204!=e.status){for(var t=[],n=0;n<e.data.data.length;n++)t.push(e.data.data[n]);i.entityTotal=e.data.total,i.$broadcast("dataCountReady",e.data.total),o(function(){i.renderData=t,i.noData=!1})}else i.entityTotal=0,i.renderData=[],i.noData=!0,i.$broadcast("dataCountReady",0)})},i.$on("dataCountReady",f),angular.element(window).resize(f),i["new"]=function(){a.go("entityAdd",{entity:i.model})},i.setEdited=function(e,t){if(t){var i={_id:e._id.$id};i[t]=e[t],l.saveEntity(n.entity,i).then(function(e){e.data.success&&r.success("Запись сохранена")})}else l.saveEntity(n.entity,{_id:e._id.$id,
enabled:e.enabled}).then(function(e){e.data.success&&r.success("Запись сохранена")})},i.selectAllItems=function(e){i.remList=[];var t=angular.element(e.currentTarget),n=t.closest("table");n.find('tbody input[type="checkbox"].remBox').prop("checked",t.is(":checked")),1==e.currentTarget.checked?angular.forEach(n.find('tbody input[type="checkbox"].remBox'),function(e){i.remList.push(e.value)}):i.remList=[],y=i.remList},i.updateRemItems=function(e){if(e.currentTarget.checked===!1){var t=c.indexOf(i.remList,e.currentTarget.value);t>-1&&i.remList.splice(t,1)}else i.remList.push(e.currentTarget.value);y=i.remList},i.isSelectItems=function(){return 0===i.remList.length},i.exportStack=function(){l.exportEntity(n.entity,y,i.curSortField,i.curSortOrder,i.searchKeywords,i.pageFilter)},i.deleteStack=function(e){var t=i.renderData,o=s.open({templateUrl:"app/components/popup/popup.html",controller:["$scope",function(i){var s=e?[e]:y;if(s.length>1)i.title="Всего выбрано элементов: "+s.length;else{var d=c.find(t,function(e){return e._id.$id==s[0]});i.title=d.title||null}i.message=s.length>1?"Вы действительно хотите удалить данные элементы?":"Вы действительно хотите удалить данный элемент?",i.ok=function(){o.close(),c.each(s,function(e){l.removeEntity(n.entity,{_id:e}).then(function(){r.success("Запись успешно удалена"),a.transitionTo(a.current,n,{reload:!0,inherit:!1,notify:!0})})})},i.cancel=function(){o.dismiss("cancel")}}]})},i.search=function(){h.searchKeywords=i.searchKeywords,d.setEntityListState(h,n.entity),i.filtered=!1,i.pageFilter={},Object.keys(i.editMode).forEach(function(e){i.editMode[e]=!1}),i.$broadcast("filter:reset"),i.displayData(0,i.perPage,i.curSortField,i.curSortOrder,i.searchKeywords)},i.keyUpHandler=function(e){13===e.keyCode&&i.search()},i.goToGraphic=function(){y&&d.saveSelectedItems(y),a.go("infographic",{entity:n.entity})},i.isRendered=function(){return!!angular.element(".fieldCell").first().text()||i.noData},i.resetFilterByKey=function(e){delete i.pageFilter[e],Object.keys(i.pageFilter).length<1&&(i.filtered=!1),i.$broadcast("filter:thisReset",e),i.editMode[e]=!1,i.displayData(0,i.perPage,i.curSortField,i.curSortOrder,i.searchKeywords,{})},i.resetFilter=function(){i.filtered=!1,i.pageFilter={},Object.keys(i.editMode).forEach(function(e){i.editMode[e]=!1}),i.displayData(0,i.perPage,i.curSortField,i.curSortOrder,i.searchKeywords,{}),i.$broadcast("filter:reset")},i.showFilter=function(e){i.editMode[e]=!0,i.onceSelected[e]=!0,o(function(){angular.element("[chosen]").trigger("chosen:updated")},100)}}])}(),function(){"use strict";angular.module("directives.atomFields",[])}(),function(){"use strict";angular.module("directives.atomFields").directive("atomForm",function(){return{restrict:"A",controller:["$scope",function(e){e.$on("atom:changeField",function(t,i){t.stopPropagation(),e.$broadcast("atom:broadcast:changeField",i)})}]}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldString",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"=",postButton:"=",postButtonAction:"="},templateUrl:"app/directives/atomFields/atomFieldString/atomFieldString.html"}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldSelect",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"=",linkedEntity:"=",entityModel:"="},templateUrl:"app/directives/atomFields/atomFieldSelect/atomFieldSelect.html",link:function(e){var t=Lazy(e.scheme.values).map(function(e,t){return{title:e,id:t}}).toArray(),i=e.scheme.multiple?e.field:[e.field],n=Lazy(i).compact().map(function(e){return Lazy(t).find(function(t){return t.id===e.$id})}).compact().toArray();e.list=t,e.entityModel[e.fieldName]=e.scheme.multiple?n:n[0]}}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldPassword",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"="},templateUrl:"app/directives/atomFields/atomFieldPassword/atomFieldPassword.html",link:function(e){e.atomPassword={type:"password",generatePassword:function(){e.atomPassword.type="text",e.field=Math.random().toString(36).slice(-8)}}}}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldNumeric",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"=",postButton:"=",postButtonAction:"="},templateUrl:"app/directives/atomFields/atomFieldNumeric/atomFieldNumeric.html"}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldHtml",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"=",postButton:"=",postButtonAction:"="},templateUrl:"app/directives/atomFields/atomFieldHtml/atomFieldHtml.html"}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldEntity",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"=",linkedEntity:"=",entityModel:"="},templateUrl:"app/directives/atomFields/atomFieldEntity/atomFieldEntity.html",link:function(e){function t(){function t(t){var i=[];return t.forEach(function(t){i=r.concat(e.entityModel[t].map(function(e){return{name:t,id:e.id}}))}),i}function n(){return s&&s.length&&r.length}function o(){return i.map(function(e){var t=r.find(function(t){return e[t.name].$id===t.id});return t?{title:e[a],id:e._id.$id}:void 0}).filter(function(e){return!!e||0===e})}function l(){return i.map(function(e){return{title:e.title,id:e.$id}})}var s=e.scheme.related,r=[];return s&&(r=t(s)),n()?o():l()}var i=[];try{i=e.linkedEntity}catch(n){}e.entityModel[e.fieldName]=e.entityModel[e.fieldName]||[];var a=e.scheme.entity.field?e.scheme.entity.field:"",o=t(),l=e.scheme.multiple?e.field:[e.field];angular.isArray(l)||(l=[]);var s=l.filter(function(e){return!!e||0===e}).map(function(e){return o.find(function(t){return t.id===e.$id})}).filter(function(e){return!!e||0===e});e.entityModel[e.fieldName]=e.scheme.multiple?s:s[0],e.list=o,e.triggerEvent=function(){e.$emit("atom:changeField",{fieldName:e.fieldName})},e.$on("atom:broadcast:changeField",function(i,n){if(n.fieldName===e.fieldName)return!1;var a=n.fieldName,o=e.scheme.related;o&&-1!==o.indexOf(a)&&(e.list=t())}),e.$on("atom:broadcast:setEntityById",function(t,i){var n=i.fieldName,a=i.id;if(n!==e.fieldName)return!1;var o=e.list.filter(function(e){return e.id===a});e.entityModel[n]=e.scheme.multiple?o:o[0]})}}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldDatetime",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"="},templateUrl:"app/directives/atomFields/atomFieldDatetime/atomFieldDatetime.html",link:function(e,t){var i="time"===e.scheme.type?"HH:mm":"date"===e.scheme.type?"DD.MM.YYYY":"DD.MM.YYYY HH:mm";e.today=function(){return e.dt=new Date,e.dt};var n=e.field&&void 0!=e.field?e.field.sec:0;n&&(e.dt=moment(1e3*n),e.field=e.dt.locale("en").format("ddd MMM DD YYYY HH:mm:ss")),angular.element(t[0].querySelector(".input-group")).datetimepicker({locale:"ru",useCurrent:!0,defaultDate:e.dt,format:i,keepOpen:!1,extraFormats:[i]}),t.find("input").on("blur",function(){if(t.find("input").val()){var i=moment(t.find("input").val(),"DD.MM.YYYY HH:mm");e.$apply(function(){e.field=i.locale("en").format("DD.MM.YYYY HH:mm"),setTimeout(function(){e.$emit("atom:changeField",{fieldName:e.fieldName})},100)}),t.find("input").trigger("input")}}),e.$watch("field",function(e,i){if(e){var n=moment(e,"DD.MM.YYYY HH:mm");angular.element(t[0].querySelector(".input-group")).data("DateTimePicker").date(n)}}),e.$watch("_field",function(n){if(n){var a=moment(t.find("input").val(),i);a===e.field||e.field||t.find("input").val("")}})}}})}(),function(){"use strict";angular.module("directives.atomFields").directive("atomFieldBoolean",function(){return{restrict:"A",scope:{scheme:"=",fieldName:"=",field:"="},templateUrl:"app/directives/atomFields/atomFieldBoolean/atomFieldBoolean.html"}})}(),function(){"use strict";angular.module("rest.infographic",[]).config(["$provide",function(e){e.decorator("InfographicAPIService",["$delegate","InfographicAPIServiceMock","debug",function(e,t,i){return i&&(e=t),e}])}])}(),function(){"use strict";angular.module("rest.infographic").service("InfographicAPIServiceMock",["$http",function(e){var t=this;t.getGraphicData=function(){return e.get("/app/rest/infographic/fixture/graphData.json")}}])}(),function(){"use strict";angular.module("rest.infographic").service("InfographicAPIService",["$http","$httpParamSerializer","baseURL","_",function(e,t,i,n){var a=this;a.getGraphicData=function(t){var n="";return t&&Lazy(t).each(function(e,t){angular.isUndefined(e)||(angular.isArray(e)?Lazy(e).each(function(e){n+="&condition["+t+"][$in][]="+e}):n+="&condition["+t+"]="+e)}),e.get(i+"/graphics/?"+n)}}])}(),function(){"use strict";angular.module("components.entity",[]).config(["$provide",function(e){e.decorator("EntityService",["$delegate","EntityServiceMock","debug",function(e,t,i){return i&&(e=t),e}])}])}(),function(){"use strict";angular.module("components.entity").service("EntityServiceMock",["$http","$httpParamSerializer",function(e,t){this.getEntities=function(){return e.get("/app/rest/entity/fixture/entities.json")},this.getEntitiesList=function(t){return e.get("/app/rest/entity/fixture/"+t+"List.json")},this.getEntityDescription=function(t){return e.get("/app/rest/entity/fixture/statisticsbybrandDescription.json")},this.getEntityPage=function(t,i,n){return 0===i?e.get("/app/rest/entity/fixture/usersPage1.json"):e.get("/app/rest/entity/fixture/usersPage2.json")},this.getEntity=function(t,i){return e.get("/app/rest/entity/fixture/userExample.json")},this.saveEntity=function(i,n){return e.get("/app/rest/entity/fixture/userSaved.json",t(n))},this.removeEntity=function(i,n){return e.get("/app/rest/entity/fixture/userSaved.json",t(n))}}])}(),function(){"use strict";angular.module("components.entity").service("EntityService",["$http","$httpParamSerializer","baseURL","_",function(e,t,i,n){function a(e){return angular.isArray(e)?n.map(e,function(e){return o(e)}):[o(e)]}function o(e){return"fields[]="+e}function l(e){var t="";return angular.forEach(e,function(e,i){switch(console.log(e),e.type){case"string":case"text":t+="&condition["+i+"][$regex]="+encodeURIComponent(e.value);break;case"datetime":case"time":case"date":case"integer":"datetime"!=i||"Invalid date"!=e.value&&void 0!=e.value||(e.value=null),e.secondaryValue?("datetime"!=i||"Invalid date"!=e.secondaryValue&&void 0!=e.secondaryValue||(e.secondaryValue=null),e.value&&(t+="&condition["+i+"][$gte]="+encodeURIComponent(e.value)),e.secondaryValue&&(t+="&condition["+i+"][$lte]="+encodeURIComponent(e.secondaryValue))):t+="integer"==e.type?"&condition["+i+"][$gte]="+encodeURIComponent(e.value):"&condition["+i+"][$gte]="+encodeURIComponent(e.value);break;case"boolean":t+="&condition["+i+"]="+encodeURIComponent(e.value);break;case"entity":case"select":angular.isArray(e.value)?angular.forEach(e.value,function(e){t+="&condition["+i+"][$in][]="+encodeURIComponent(e.id)}):t+="&condition["+i+"][$in][]="+encodeURIComponent(e.value.id)}}),t}function s(e){var t=[];return angular.forEach(e,function(e,i){switch(console.log(e.type),e.type){case"string":case"text":t.push(angular.element('<input type="hidden" name=" condition['+i+'][$regex]" value="'+encodeURIComponent(e.value)+'" />'));break;case"datetime":case"time":case"date":case"integer":"datetime"!=i||"Invalid date"!=e.value&&void 0!=e.value||(e.value=null),e.secondaryValue?("datetime"!=i||"Invalid date"!=e.secondaryValue&&void 0!=e.secondaryValue||(e.secondaryValue=null),e.value&&t.push(angular.element('<input type="hidden" name="condition['+i+'][$gte]" value="'+encodeURIComponent(e.value)+'" />')),e.secondaryValue&&t.push(angular.element('<input type="hidden" name="condition['+i+'][$lte]" value="'+encodeURIComponent(e.secondaryValue)+'" />'))):"integer"==e.type?t.push(angular.element('<input type="hidden" name="condition['+i+'][$gte]" value="'+encodeURIComponent(e.value)+'" />')):t.push(angular.element('<input type="hidden" name="condition['+i+'][$gte]" value="'+encodeURIComponent(e.value)+'" />'));break;case"boolean":t.push(angular.element('<input type="hidden" name="condition['+i+']" value="'+encodeURIComponent(e.value)+'" />'));break;case"entity":case"select":angular.forEach(e.value,function(e){t.push(angular.element('<input type="hidden" name="condition['+i+'][$in][]" value="'+encodeURIComponent(e.id)+'" />'))})}}),t}var r=this;this.getEntities=function(t){var n=t?"?condition[name]="+t:"";return e.get(i+"/atom/entities/"+n)},this.getEntitiesList=function(t,n,a,o){n=n||0;var l=o?"&fields[]="+o:"",s="";if(angular.isObject(a))for(var r in a)s+="&sort["+r+"]="+a[r];return e.get(i+"/"+t+"/?condition[enabled][$ne]=null&limit="+n+s+l)},this.getEntityDescription=function(e){return r.getEntities(e)},this.getEntityPage=function(t,n,o,s,r,c,d,u){var p=s&&r?"&sort["+s+"]="+r:"",m=c?"&condition[$query]="+c+"&condition[ref_entity]="+t:"",f=d&&d.length?"&"+a(d).join("&")+"&fields[]=enabled":"",g=l(u);return m?e.get(i+"/search/page/"+n+"/?condition[enabled][$ne]=null&limit="+o+p+f+m+g):e.get(i+"/"+t+"/page/"+n+"/?condition[enabled][$ne]=null&limit="+o+p+f+g)},this.getEntity=function(t,n){return e.get(i+"/"+t+"/"+n+"/")},this.saveEntity=function(t,n,a,o){var l="undefined"==typeof n._id&&a?"create":"update";return o?e.post(i+"/"+t+"/"+l+"/",n,{headers:{"X-Requested-With":"XMLHttpRequest","Content-Type":void 0,Accept:"application/json"}}):e.post(i+"/"+t+"/"+l+"/",$.param(n))},this.removeEntity=function(n,a){return e.post(i+"/"+n+"/delete/",t(a))},this.exportEntity=function(e,t,i,a,o,l){var r=[],c=s(filter);if(t.length)for(var d=0;d<t.length;d++)r.push(angular.element('<input type="hidden" name="condition[_id][$in][]" value="'+t[d]+'">'));var u=angular.element("#downloadForm");u.html("");var p=angular.element('<input type="hidden" name="limit" value="0">'),m=i&&a?angular.element('<input type="hidden" name="sort['+i+']" value="'+a+'">'):"",f=o?angular.element('<input type="hidden" name="condition[$search]" value="'+o+'">'):"";r=r.concat(c),n.each(r,function(e){u.append(e)}),u.append(p),u.append(m),u.append(f),u.attr({action:"/"+e+"/export/"+filterString})[0].submit()},this.getLinkedEntities=function(t,n,o){var l=a(n),s=[];if(o.length){var r,c;for(r=0,c=0;r<o.length;r++,c++)o[r]&&l.push("condition[_id][$in][]="+o[r].$id),19!=c&&r!=o.length-1||(l=l.join("&"),s.push(e.get(i+"/"+t+"/?"+l+"&limit=0")),c=-1,l=a(n))}return s}}])}(),function(){"use strict";angular.module("components.auth",[]).config(["$provide",function(e){e.decorator("AuthService",["$delegate","$location","AuthServiceMock","debug",function(e,t,i,n){return n&&(e=i),e}])}])}(),function(){"use strict";angular.module("components.auth").service("AuthServiceMock",["$http",function(e){this.logout=function(){return e.get("/app/rest/auth/fixture/logout_success.json")},this.login=function(t){var i=0===t.email.indexOf("test")?"auth.json":"auth_fail.json";return e.get("/app/rest/auth/fixture/"+i)},this.properties=function(){return e.get("/app/rest/auth/fixture/properties.json")}}])}(),function(){"use strict";angular.module("components.auth").service("AuthService",["$http","$httpParamSerializer","$q","baseURL",function(e,t,i,n){var a=this;a.cache={},this.logout=function(){return e.get(n+"/user/logout/")},this.login=function(i){return e.post(n+"/user/auth/pass/",t(i))},this.properties=function(){return a.cache.properties?i.when(a.cache.properties):e.get(n+"/atom/properties/").then(function(e){return a.cache.properties=e,e})}}])}(),function(){"use strict";angular.module("infographic",[]).config(["$stateProvider",function(e){e.state("infographic",{url:"/graphics/:entity",views:{"content@":{templateUrl:"app/modules/infographic/infographic.html",controller:"InfographicCtrl"}}})}])}(),function(){"use strict";angular.module("infographic").controller("InfographicCtrl",["$scope","$timeout","$stateParams","EntityService","HelperService","SessionService","AtomDiagramFactory","InfographicAPIService",function(e,t,i,n,a,o,l,s){function r(){return g&&g.length&&m}function c(){e.line1=l.line1,e.line1.options.xaxis.axisLabel=u,e.line1.options.yaxis.axisLabel=p}var d,u,p,m,f=i.entity,g=o.getSelectedItems();e.entity={},e.showGraph=!1,e.entityModels={},e.linkedEntities={},n.getEntityDescription(f).then(function(t){if(d=t.data[f].atomgraphics.controls,_.find(d,function(e,t){return e["default"]?(m=t,e):void 0}),r()){o.clearSelectedItems();var i=[];e.entityModels[m]=[],_.each(g,function(t){i.push({$id:t}),e.entityModels[m].push({id:t})}),e.entity[m]=i}return u=t.data[f].atomgraphics.axes.abscissa.title,p=t.data[f].atomgraphics.axes.ordinate.title,c(),a.getLinkedEntities(d)}).then(function(t){var i={};Lazy(t).each(function(e){i[e.entity]=e}),e.linkedEntities=i,e.scheme=d,d=null}).then(function(){r()&&e.getGiagram()}),e.getGiagram=function(){var t={entity:f};Lazy(e.scheme).each(function(i,n){switch(i.type){case"entity":Lazy(e.entityModels[n]).each(function(e,i){t[n]||(t[n]=[]),t[n].push(e.id)});break;case"select":t[n]=e.entityModels[n]?e.entityModels[n].id:void 0;break;default:t[n]=e.entity[n]}}),s.getGraphicData(t).then(function(t){var i=[];Lazy(t.data.data).each(function(e){var t=e.title;Lazy(e.data).each(function(e,n){i.push({data:e,label:t+" - "+n})})}),e.line1.data=i,e.showGraph=!0})}}])}(),function(){"use strict";angular.module("errorPage",[]).config(["$stateProvider",function(e){e.state("error500",{views:{"content@":{templateUrl:"app/modules/errorPage/500.html",controller:"ErrorPageCtrl"}}})}])}(),function(){"use strict";angular.module("errorPage").controller("ErrorPageCtrl",["$scope","$rootScope",function(e,t){t.hidePanels=!0,e.closeError=function(){t.hidePanels=!1}}])}(),function(){"use strict";angular.module("dashboard",["components.session","components.auth"]).config(["$stateProvider",function(e){e.state("dashboard",{url:"/",views:{"content@":{templateUrl:"app/modules/dashboard/dashboard.html",controller:"DashboardCtrl"}}})}])}(),function(){"use strict";angular.module("dashboard").controller("DashboardCtrl",["$state","$cookies","$rootScope","$timeout",function(e,t,i,n){i.authorized&&n(function(){var i=t.get("homepage");e.go("entitiesList",{entity:i})})}])}(),function(){"use strict";angular.module("authorization",["components.session","components.auth"]).config(["$stateProvider","$urlRouterProvider",function(e,t){t.otherwise("/"),e.state("login",{url:"/login",views:{"content@":{templateUrl:"app/modules/authorization/authorization.html",controller:"AuthorizationCtrl"}}}).state("logout",{url:"/logout",views:{"content@":{templateUrl:"app/modules/authorization/authorization.html",controller:"AuthorizationCtrl"}}})}])}(),function(){"use strict";angular.module("authorization").controller("AuthorizationCtrl",["$scope","$rootScope","$state","$document","$http","$cookies","AuthService","toastr","SessionService","$stateParams","loginPeriod",function(e,t,i,n,a,o,l,s,r,c,d){var u=31536e6;e.rememberMe=!0,i.is("logout")&&(t.hidePanels=!0,t.authorized=!1,void 0!==r.getSessionID()&&(r.setSessionID(void 0),o.remove("token"),o.remove("rememberMe"),o.remove("user"),o.remove("userId"),o.remove("sessionId"),l.logout()),i.go("login")),e.makeLogin=function(){l.login(e.user).then(function(e){return e.data.success?(a.defaults.headers.common.Token=e.data.success.user.token,l.properties().then(function(t){return{response:e,properties:t}})):void s.error(e.data.error.message)}).then(function(a){var l=a.response,c=a.properties.data.homepage,p=new Date,m={path:"/"};e.rememberMe?p.setTime(p.getTime()+u):p.setTime(p.getTime()+d),m.expires=p,r.setSessionID(l.data.success.user.token,p),r.setUserID(l.data.success.user._id.$id,p),s.success(l.data.success.message),n.find(".body-wide").removeClass("body-wide").removeClass("body-lock"),t.authorized=!0,t.hidePanels=!1,t.userName=l.data.success.user.name,o.put("token",l.data.success.user.token,m),o.put("homepage",c,m),o.put("rememberMe",e.rememberMe?1:0,m),i.go("entitiesList",{entity:c})})}}])}(),function(){"use strict";angular.module("directives.crmEntityFilter",[])}(),function(){"use strict";angular.module("directives.crmEntityFilter").directive("crmEntityFilter",function(){return{restrict:"E",link:function(e,t){e.$elem=t,e.scheme=angular.copy(e.field),"entity"!=e.scheme.type&&"select"!=e.scheme.type||(e.scheme.multiple=!0);var i=function(){var t;switch(e.field.type){case"string":t="string";break;case"integer":t="integer";break;case"datetime":t="datetime";break;case"boolean":t="boolean";break;case"select":t="select";break;case"entity":t="entity"}return"app/directives/crmEntityFilter/templates/"+t+"Filter.html"};e.filterUrl=i()},template:'<div ng-include="filterUrl"></div>',controller:["$scope","$element",function(e,t){e.model={fieldValue:void 0,secondaryValue:void 0},e.entityModel=[],e.applyInterval=function(t,i){e.interval=!e.interval,e.applyFilter(t,i)},e.applyFilter=function(t,i){if("integer"==e.field.type&&(t||i)||"integer"!=e.field.type){var n,a=!1;if("Количество проверок"==e.scheme.title&&(e.model.fieldValue=t,e.model.secondaryValue=i),n={fieldName:e.fieldKey,type:e.field.type,value:e.model.fieldValue},"entity"!=e.field.type&&"select"!=e.field.type||(n.value=e.entityModel[e.fieldKey]),!a&&e.model.secondaryValue)if(n.secondaryValue=e.model.secondaryValue,"integer"==e.field.type)a=e.model.fieldValue>e.model.secondaryValue;else{var o=e.model.fieldValue?{d:e.model.fieldValue.split(".")[0],M:e.model.fieldValue.split(".")[1],y:e.model.fieldValue.split(".")[2].split(" ")[0]}:{},l=e.model.secondaryValue?{d:e.model.secondaryValue.split(".")[0],M:e.model.secondaryValue.split(".")[1],y:e.model.secondaryValue.split(".")[2].split(" ")[0]}:{};moment(o).unix()>moment(l).unix()&&(toastr.error("Конечная дата меньше начальной!"),e.$emit("filter:applied",{fieldName:e.fieldKey,type:e.field.type,value:void 0,secondaryValue:void 0}),a=!0)}a||e.$emit("filter:applied",n)}},e.$on("atom:changeField",function(){e.applyFilter()}),e.$on("filter:thisReset",function(t,i){i===e.fieldKey&&(e.$elem.find("[chosen]").val("выберите один или несколько вариантов").trigger("chosen:updated"),e.model.fieldValue=void 0,e.model.secondaryValue=void 0)}),e.$on("filter:reset",function(){e.model.fieldValue=void 0,e.model.secondaryValue=void 0,e.entityModel={}})}]}})}(),function(){"use strict";angular.module("directives.atomGlobalPopup",[])}(),function(){"use strict";angular.module("directives.atomGlobalPopup").directive("atomGlobalPopup",function(){return{restrict:"AEC",scope:{showGlobalPopup:"=",errorMessage:"="},controller:["$scope","$uibModal",function(e,t){function i(){t.open({animation:!0,templateUrl:"app/directives/atomGlobalPopup/atomGlobalPopup.html",windowClass:"customModal",controller:"AtomGlobalPopupCtrl",size:"sm",scope:e,resolve:{}})}e.$watch("showGlobalPopup",function(){e.showGlobalPopup&&(e.showGlobalPopup=!1,i())})}]}})}(),function(){"use strict";angular.module("directives.atomGlobalPopup").controller("AtomGlobalPopupCtrl",["$scope","$uibModalInstance",function(e,t){e.closePopup=function(){t.dismiss("cancel")}}])}(),function(){"use strict";angular.module("directives.atomDiagram",[]).constant("moment",moment)}(),function(){"use strict";angular.module("directives.atomDiagram").factory("AtomDiagramFactory",["moment",function(e){var t=this;return t.line1={},t.line1.data=[{data:[],label:"Trend"}],t.line1.options={series:{shadowSize:0,lines:{show:!0,fill:!1,fillColor:{colors:[{opacity:0},{opacity:.3}]}},points:{show:!0,lineWidth:2,fill:!0,fillColor:"#ffffff",symbol:"circle",radius:5}},tooltip:{show:!0,content:function(t,i,n){return"Date: "+e(1e3*i).format("DD MMMM YYYY")+" Total Hours: "+n},defaultTheme:!0},tooltipOpts:{defaultTheme:!1},grid:{hoverable:!0,clickable:!0,tickColor:"#f9f9f9",borderWidth:1,borderColor:"#eeeeee"},xaxis:{ticks:[]},yaxis:{},legend:{container:"#legend"}},t}])}(),function(){"use strict";angular.module("directives.atomDiagram").directive("atomFlotChart",[function(){return{restrict:"A",scope:{data:"=flotData",options:"=flotOptions"},link:function(e,t){var i,n,a;return i=e.data,n=e.options,e.$watch("data",function(){a.setData(e.data),a.setupGrid(),a.draw()},!0),a=$.plot(t[0],i,n)}}}])}(),function(){"use strict";angular.module("components.siteHeader",["components.session"])}(),function(){"use strict";angular.module("components.siteHeader").directive("siteHeader",["$state","SessionService",function(e,t){return{restrict:"EA",scope:!0,templateUrl:"app/components/siteHeader/siteHeader.html",controller:["$scope",function(i){i.notifications=0,i.ques=0,i.userName="Fake",i.showMenu=!1,i.isAuthorized=function(){return!!t.getSessionID()},i.goToSearch=function(){e.go("customerSearch")}}]}}])}(),function(){"use strict";angular.module("components.session",[]).value("Session",{})}(),function(){"use strict";angular.module("components.session").service("SessionService",["$cookies","Session",function(e,t){this.selectedItems,this.getUserID=function(){return e.get("userId")},this.setUserID=function(t,i){var n=new Date;return i=i||n.getTime()+108e5,n.setTime(i),e.put("userId",t,{expires:n})},this.setSessionID=function(t,i){var n=new Date;return i=i||n.getTime()+108e5,n.setTime(i),e.put("sessionId",t,{expires:n})},this.getSessionID=function(){return e.get("sessionId")},this.setEntityListState=function(t,i){return e.putObject("entity_"+i,t)},this.getEntityListState=function(t){return e.getObject("entity_"+t)},this.saveSelectedItems=function(e){this.selectedItems=e},this.getSelectedItems=function(){return this.selectedItems},this.clearSelectedItems=function(){this.selectedItems=null}}])}(),function(){"use strict";angular.module("components.popup",[])}(),function(){"use strict";angular.module("components.popup").directive("confirmDelete",function(){return{restrict:"EA",transclude:!0,scope:!0,templateUrl:"app/components/popup/popup.html",controller:["$scope",function(e){}]}})}(),function(){"use strict";angular.module("components.popup").controller("ModalRemoveCtrl",["$scope","$stateParams","$modalInstance",function(e,t,i){e.ok=function(){EntityService.removeEntity(t.entity,e.form),i.dismiss("cancel")},e.cancel=function(){i.dismiss("cancel")}}])}(),function(){"use strict";angular.module("components.pagination",[])}(),function(){"use strict";angular.module("components.pagination").directive("atomPagination",function(){return{restrict:"E",scope:!0,templateUrl:"app/components/pagination/pagination.html",controller:["$scope",function(e){e.scrollConfig={scrollX:"bottom",scrollY:"none",useBothWheelAxes:!0},e.numPerPageOpt=[{value:10,title:10},{value:20,title:20},{value:50,title:50},{value:100,title:100},{value:0,title:"Все"}],e.curPage=0,e.perPage=e.numPerPageOpt[2],e.$parent.perPage=e.perPage.value,e.pagesCount=0,e.itemsCount=0;e.$on("dataCountReady",function(t,i){e.itemsCount=i,e.pagesCount=e.perPage.value>0?Math.ceil(e.itemsCount/e.perPage.value):1,e.pagesCountList=e.pagesList(),e.pagesList(),e.$emit("content.changed")}),e.getCounter=function(){return e.perPage.value<e.$parent.entityTotal&&e.perPage.value?e.perPage.value:e.$parent.entityTotal},e.onNumPerPageChange=function(){e.curPage=0,e.$parent.perPage=e.perPage.value,e.pagesCount=e.perPage.value>0?Math.ceil(e.itemsCount/e.perPage.value):1,e.pagesCountList=e.pagesList(),e.displayData(e.curPage,e.perPage.value,e.curSortField,e.curSortOrder,e.searchKeywords)},e.goToPage=function(t){t>=0&&t<e.pagesCount&&(e.curPage=t,e.displayData(e.curPage,e.perPage.value,e.curSortField,e.curSortOrder,e.searchKeywords))},e.prevPage=function(t){return t?(e.goToPage(0),!1):void(e.curPage>0&&e.goToPage(e.curPage-1))},e.nextPage=function(t){return t?(e.goToPage(e.pagesCount-1),!1):void(e.curPage<e.pagesCount-1&&e.goToPage(e.curPage+1))},e.noPrevious=function(){return e.curPage<=0},e.noNext=function(){return e.curPage+1>=e.pagesCount},e.isActive=function(t){return e.curPage==t},e.pagesList=function(){var t=[];if(e.pagesCount>0)for(var i=1;i<=e.pagesCount;i++)t.push(i);return t.length?t:[1]},e.isInRange=function(t){e.pagesCount;return!0}}]}})}(),function(){"use strict";angular.module("components.navbar",["components.session"])}(),function(){"use strict";angular.module("components.navbar").directive("navbar",["SessionService",function(e){return{restrict:"EA",scope:!0,templateUrl:"app/components/navbar/navbar.html",controller:["$scope","$state","$element","$timeout","AuthService",function(e,t,i,n,a){e.pages=[],i.find(".infoblockMenu ul").show(),a.properties().then(function(t){var i=_.clone(t.data.entities),a=_.clone(t.data.menu);n(function(){e.pages=_.chain(a).each(function(e,t){e.title=t,e.entities={},e.links.forEach(function(t,n){e.entities[t]=i[t],e.entities[t].entityName=t})}).value()})})}]}}])}(),function(){"use strict";angular.module("components.helper",[])}(),function(){"use strict";angular.module("components.helper").service("HelperService",["$q","EntityService",function(e,t){var i=this;return i.stripTags=function(e){return e?e.toString().replace(/<\/?[^>]+>/gi,""):""},i.getLinkedEntities=function(i,n){var a=Lazy(i).map(function(e){return"entity"===e.type&&(!n||n&&e.sort)?t.getEntitiesList(e.entity.model,0,0,e.entity.field).then(function(t){return{entity:e.entity.model,data:t.data}}):void 0}).compact().toArray();return e.all(a)},i}])}(),function(){"use strict";angular.module("components.collapseNav",[])}(),function(){"use strict";angular.module("components.collapseNav").directive("collapseNav",["SessionService",function(e){return{restrict:"A",controller:["$scope","$stateParams",function(e,t){e.openCurrent=function(){angular.element("#"+t.entity).parent("ul.submenu").slideToggle()}}],link:function(e,t,i){function n(){if(!(t.find("ul").parent("li").length<1)){var i,a,o,l,s,r,c,d,u,p;return c=$(window),l=t.find("ul").parent("li"),l.append('<i class="fa fa-angle-down icon-has-ul-h"></i><i class="fa fa-angle-right icon-has-ul"></i>'),l.removeClass("open").find("ul").hide(),e.openCurrent(),i=l.children("a"),s=t.children("li").not(l),a=s.children("a"),o=$("#app"),r=$("#nav-container"),i.on("click",function(e){var t,i;return o.hasClass("nav-collapsed-min")||r.hasClass("nav-horizontal")&&c.width()>=768?!1:(i=$(this),t=i.parent("li"),l.not(t).removeClass("open").find("ul").slideUp(),t.toggleClass("open").find("ul").stop().slideToggle(),e.preventDefault())}),a.on("click",function(e){return l.removeClass("open").find("ul").slideUp()}),e.$on("nav:reset",function(e){return l.removeClass("open").find("ul").slideUp()}),d=void 0,u=c.width(),p=function(){var e;return e=c.width(),768>e&&o.removeClass("nav-collapsed-min"),768>u&&e>=768&&r.hasClass("nav-horizontal")&&l.removeClass("open").find("ul").slideUp(),u=e},c.resize(function(){return setTimeout(p,300)})}setTimeout(n,500)}n()}}}])}(),function(){"use strict";angular.module("components.buildFormMarkup",[])}(),function(){"use strict";angular.module("components.buildFormMarkup").directive("buildFormMarkup",["$compile",function(e){var t={restrict:"A",link:function(i,n,a){if(a.markupData){var o=JSON.parse(a.markupData);"true"==a.fieldReadonly&&(o.readonly=!0);var l=MarkupFactory(/video/i.test(o.name)?"video":o.type);"function"==typeof window[l]&&(t=window[l](o))&&(n.html(e(t.markup)(i)),t.callback(n))}return!0}};return t}])}(),function(){"use strict";angular.module("components.atomPassword",[])}(),function(){"use strict";angular.module("components.atomPassword").directive("atomPassword",["SessionService",function(e){return{restrict:"AE",transclude:!0,template:"<span ng-transclude></span>",link:function(e){e.atomPassword={type:"password",generatePassword:function(){e.atomPassword.type="text",e.form[e.key]=Math.random().toString(36).slice(-8)}}}}}])}(),function(){"use strict";angular.module("components.atomFile",[])}(),function(){"use strict";angular.module("components.atomFile").directive("atomFile",["SessionService",function(e){return{restrict:"A",controller:["$scope","$element","Lightbox",function(e,t,i){t.find("a").click(function(e){t.find("input").trigger("click")}),t.find("input").change(function(){var i=t.find("input")[0].files;e.form[t.find("input").attr("name")]=i[0],
e.form[t.find("input").attr("name")].updateFile=!0}),e.openLightboxModal=function(e){i.openModal([{url:e.target.src,caption:"",thumbUrl:""}],0)}}]}}])}(),function(){"use strict";angular.module("components.entityMarkup",[])}(),function(){"use strict";angular.module("components.entityMarkup").directive("entityMarkup",function(){return{restict:"AE",controller:["$scope","EntityService","_",function(e,t,i){e.optionsData[e.key].options=[];var n=[],a=e.field.entity.field||"title";t.getEntitiesList(e.optionsData[e.key].entity.model,null,e.optionsData[e.key].entity.sort,a).then(function(t){e.form[e.key]=[],i.each(t.data.data,function(t){var o={name:t[a],id:t._id.$id};if(n.push(o),e.optionsData[e.key].multiple){var l=e.optionsData[e.key];angular.isArray(l.sourceValues)||(l.sourceValues=[l.sourceValues]),i.find(l.sourceValues,function(e){return e.$id==o.id})&&e.form[e.key].push(o)}else e.optionsData[e.key].sourceValues&&!i.isEmpty(e.optionsData[e.key].sourceValues)||!e.optionsData[e.key]["default"]||e.optionsData[e.key]["default"].$id!==o.id||(e.form[e.key]=o),e.optionsData[e.key].sourceValues&&e.optionsData[e.key].sourceValues.$id==o.id&&(e.form[e.key]=o)}),e.options=n})}]}})}(),function(){"use strict";angular.module("components.entityMarkup").directive("entityListMarkup",function(){return{restict:"AE",scope:{entity:"=",entityName:"=",field:"="},template:function(){return'<span ng-if="!file && !img" style="{white-space: nowrap}">{{::title}}</span><img ng-if="!file && img" ng-src="{{title}}" ng-click="openLightboxModal($event)"><a ng-if="file && !img" href="{{route}}">{{title}}</a>'},controller:["$scope","$filter","EntityService","Lightbox","HelperService",function(e,t,i,n,a){switch(e.field.type){case"date":e.title=e.entity?t("date")(1e3*e.entity.sec,"dd.MM.yyyy"):"";break;case"datetime":e.title=e.entity?t("date")(1e3*e.entity.sec,"dd.MM.yyyy HH:mm"):"";break;case"time":e.title=e.entity?t("date")(1e3*e.entity.sec,"HH:mm"):"";break;case"select":e.title=e.field.values[e.entity];break;case"entity":var o=[];_.each(e.$parent.linkedEntities[e.entityName],function(t){angular.isArray(e.entity)?(_.each(e.entity,function(e){t&&t.$id==e.$id&&o.push(t.title)}),e.title=o.join(", ")):t&&e.entity&&t.$id==e.entity.$id&&(e.title=t.title)});break;case"boolean":e.title=e.entity?"Да":"Нет";break;case"image":e.title=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].route:"",e.img=!0;break;case"file":e.title=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].title:"",e.route=e.entity&&"undefined"!=typeof e.entity[0]?e.entity[0].route:"",e.file=!0;break;default:e.title=a.stripTags(e.entity)}e.openLightboxModal=function(e){n.openModal([{url:e.target.src,caption:"",thumbUrl:""}],0)}}]}})}(),function(){"use strict";angular.module("components.atomDatetimepicker",[])}(),function(){"use strict";angular.module("components.atomDatetimepicker").directive("atomDatetimepicker",function(){return{restrict:"AEC",scope:{pick12HourFormat:"@",language:"@",useCurrent:"@",location:"@",mode:"@",form:"=",mModel:"=",readonly:"=",dataName:"@dataName",dataType:"@dataType"},templateUrl:"app/components/atomDatetimepicker/atomDatetimepicker.html",link:function(e,t,i){function n(){var i=moment(t.find("input").val(),a);e.form[e.dataName]=i.toString().replace(/( \((.+)\))/g,""),t.find("input").trigger("input")}var a="time"===e.dataType?"HH:mm":"date"===e.dataType?"DD.MM.YYYY":"DD.MM.YYYY HH:mm";e.today=function(){return e.dt=new Date,e.dt},e.form.hasOwnProperty(e.dataName)&&e.form[e.dataName]?e.dt=moment(1e3*e.form[e.dataName].sec):e.today(),t.datetimepicker({locale:e.language,useCurrent:e.useCurrent,defaultDate:e.dt,format:a,extraFormats:[a],tooltips:{today:"Сегодня",clear:"Очистить",close:"Закрыть",selectMonth:"Выбрать месяц",prevMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",selectYear:"Выбрать год",prevYear:"Предыдущий год",nextYear:"Следующий год",selectDecade:"Выбрать декаду",prevDecade:"Пердыдущая декада",nextDecade:"Следующая декада",prevCentury:"Предыдущее столетье",nextCentury:"Следующее столетье",pickHour:"Выбрать час",incrementHour:"Увеличить час",decrementHour:"Уменьшить час",pickMinute:"Выбрать минуту",incrementMinute:"Увеличить минуту",decrementMinute:"Уменьшить минуту",pickSecond:"Выбрать секунду",incrementSecond:"Увеличить секунду",decrementSecond:"Уменьшить секунду",togglePeriod:"Переключить период",selectTime:"Выбрать время"}}),n(),t.find("input").on("blur",function(){n()})}}})}(),function(){"use strict";angular.module("components.atomDatetimepicker").controller("AtomDatetimepickerCtrl",["$scope","$rootScope",function(e,t){e.vm={message:"Bootstrap DateTimePicker Directive",dateTime:{}},e.$watch("change",function(){console.log(e.vm.dateTime)})}])}(),function(){"use strict";angular.module("components.atomDatepicker",[])}(),function(){"use strict";angular.module("components.atomDatepicker").directive("atomDatepicker",["SessionService",function(e){return{restrict:"A",controller:["$scope","$element","uibDatepickerPopupConfig",function(e,t,i){var n=t.find("input").attr("name");return i.clearText="Очистить",i.closeText="Закрыть",i.currentText="Сегодня",e.today=function(){return e.dt=new Date,e.dt},e.form.hasOwnProperty(n)&&e.form[n]?e.dt=new Date(1e3*e.form[n].sec):e.today(),e.open=function(t){return t.preventDefault(),t.stopPropagation(),e.opened=!0,e.opened},e.dateOptions={"year-format":"'yy'","starting-day":1},e.$watch("dt",function(){e.form[n]=e.dt.toString().replace(/( \((.+)\))/g,""),e.$emit("setDateVar",e.dt)}),e.$watch("form.date",function(){e.form[n]||e.today()}),e.format="dd.MM.yyyy",e.format}]}}])}(),function(){"use strict";angular.module("components.aclMarkup",[])}(),function(){"use strict";angular.module("components.aclMarkup").directive("aclMarkup",function(){return{restict:"AE",controller:["$scope","$q","EntityService","AuthService","_",function(e,t,i,n,a){t.all([n.properties(),i.getEntities()]).then(function(t){var i=t[0].data.entities,n=t[1].data,o=a.map(n,function(e,t){return e.name=t,e.position=angular.isDefined(i[t])?i[t].position:1001,e});o.unshift({title:"Административная панель",name:"atom",position:0}),o.unshift({title:"Сайт",name:"index",position:0}),o=a.sortBy(o,function(e){return e.position}),a.each(o,function(t){var i=t.name;"undefined"==typeof e.optionsData[e.key].sourceValues[i]&&(e.optionsData[e.key].sourceValues[i]={}),e.optionsData[e.key].sourceValues[i].title=t.title,e.optionsData[e.key].sourceValues[i].key=i,e.optionsData[e.key].options.push(e.optionsData[e.key].sourceValues[i])})})}]}})}(),angular.module("ngLocale",[],["$provide",function(e){var t={ZERO:"zero",ONE:"one",TWO:"two",FEW:"few",MANY:"many",OTHER:"other"};e.value("$locale",{DATETIME_FORMATS:{AMPMS:["до полудня","после полудня"],DAY:["воскресенье","понедельник","вторник","среда","четверг","пятница","суббота"],MONTH:["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"],SHORTDAY:["вс","пн","вт","ср","чт","пт","сб"],SHORTMONTH:["янв.","февр.","марта","апр.","мая","июня","июля","авг.","сент.","окт.","нояб.","дек."],fullDate:"EEEE, d MMMM y 'г'.",longDate:"d MMMM y 'г'.",medium:"dd.MM.yyyy H:mm:ss",mediumDate:"dd.MM.yyyy",mediumTime:"H:mm:ss","short":"dd.MM.yy H:mm",shortDate:"dd.MM.yy",shortTime:"H:mm"},NUMBER_FORMATS:{CURRENCY_SYM:"руб.",DECIMAL_SEP:",",GROUP_SEP:" ",PATTERNS:[{gSize:3,lgSize:3,macFrac:0,maxFrac:3,minFrac:0,minInt:1,negPre:"-",negSuf:"",posPre:"",posSuf:""},{gSize:3,lgSize:3,macFrac:0,maxFrac:2,minFrac:2,minInt:1,negPre:"-",negSuf:" ¤",posPre:"",posSuf:" ¤"}]},id:"ru-ru",pluralCat:function(e){return e%10==1&&e%100!=11?t.ONE:e==(0|e)&&e%10>=2&&4>=e%10&&(12>e%100||e%100>14)?t.FEW:e%10==0||e==(0|e)&&e%10>=5&&9>=e%10||e==(0|e)&&e%100>=11&&14>=e%100?t.MANY:t.OTHER}})}]),function(){"use strict";angular.module("atom",["ngAnimate","ngCookies","ngTouch","ngSanitize","vAccordion","ng.deviceDetector","ui.router","ui.tinymce","ui.bootstrap","ui.tree","ngScrollable","underscore","localytics.directives","components.session","components.auth","components.siteHeader","components.navbar","components.collapseNav","components.entity","components.pagination","components.buildFormMarkup","components.atomDatepicker","components.entityMarkup","components.aclMarkup","components.popup","components.atomPassword","components.atomFile","components.atomDatetimepicker","components.helper","directives.atomFields","directives.atomDiagram","directives.crmEntityFilter","rest.infographic","bootstrapLightbox","infographic","authorization","dashboard","entityPage","errorPage"])}(),function(){"use strict";angular.module("atom").run(["$rootScope","$state","$http","SessionService","EntityService",function(e,t,i,n,a){e.$on("$stateChangeSuccess",function(i,o,l,s){if(e.activePage=o.name,e.activeEntity="pagesList"===o.name?"page":l.entity,!("logout"===s.name&&"login"===o.name||"login"===s.name&&"logout"===o.name)){"error500"==s.name&&(e.activePage=o.name,e.activeEntity=l.entity,e.hidePanels=!1);var r=["login","logout"],c=n.getSessionID();c&&(e.authorized=!0,a.getEntity("user",n.getUserID()).then(function(i){i.data.error&&403==i.data.error.code?t.go("logout"):e.userName=i.data.data[0].title},function(){t.go("logout")})),Lazy(r).contains(o.name)||c||t.go("logout"),c&&"login"===o.name&&t.go("dashboard")}})}])}(),function(){"use strict";angular.module("atom").constant("toastr",toastr).constant("moment",moment).constant("baseURL",BASE_URI).constant("debug",-1!==window.location.search.indexOf("debug")).constant("loginPeriod",18e5)}(),function(){"use strict";angular.module("atom").config(["$logProvider","$httpProvider","$stateProvider","toastr","SessionServiceProvider",function(e,t,i,n,a){t.defaults.headers.post={Accept:"application/json","Content-Type":"application/x-www-form-urlencoded"},t.defaults.headers.get={Accept:"application/json"},a.$get().getSessionID()&&(t.defaults.headers.common.Token=a.$get().getSessionID()),t.interceptors.push(["$q","$injector","_","loginPeriod",function(e,t,i,a){return{request:function(e){var i=t.get("$cookies").get("rememberMe"),n=t.get("$cookies").get("token"),o=t.get("$cookies").get("homepage");if(n&&"0"===i){var l=new Date;l.setTime(l.getTime()+a);var s={expires:l,path:"/"};t.get("$cookies").put("token",n,s),t.get("$cookies").put("rememberMe",n,s),t.get("$cookies").put("homepage",o,s)}return e},responseError:function(a){return 500==a.status&&(t.get("$rootScope").errorMessage=a.data.error.message,t.get("$state").go("error500")),401==a.status&&"/user/logout/"!==a.config.url?t.get("$state").go("logout"):400==a.status?a.data.error.message&&n.error(a.data.error.message):403==a.status?"/atom/properties/"==a.config.url&&(a.data.error.message&&n.error(a.data.error.message),t.get("$state").go("logout")):i.each(a.data.error["null"],function(e){e.message&&n.error(e.message)}),e.reject(a)}}}]),e.debugEnabled(!0),n.options.timeOut=3e3,n.options.positionClass="toast-top-right",n.options.preventDuplicates=!1,n.options.closeButton=!0}]).value("froalaConfig",{toolbarButtons:["fullscreen","bold","italic","underline","strikeThrough","subscript","superscript","fontFamily","fontSize","|","color","inlineStyle","paragraphStyle","|","paragraphFormat","align","formatOL","formatUL","outdent","indent","-","insertLink","insertImage","insertVideo","insertFile","insertTable","undo","redo","clearFormatting","selectAll","html","quote","insertHR"],toolbarInline:!1,language:"ru",heightMin:100,heightMax:200})}(),angular.module("atom").run(["$templateCache",function(e){e.put("app/components/atomDatetimepicker/atomDatetimepicker.html","<input type=text class=form-control id={{dataName}} name={{dataName}} ng-disabled=readonly> <span class=input-group-addon><i class=fa ng-class=\"{\r\n    'fa-calendar': (dataType === 'date' || dataType === 'datetime'),\r\n    'fa-clock-o':  dataType === 'time'\r\n    }\"></i> </span>"),e.put("app/components/navbar/navbar.html",'<!--<div class="nav-wrapper">--><!--<ul id="nav"--><!--class="nav"--><!--data-slim-scroll--><!--data-collapse-nav--><!--data-highlight-active>--><!--<li class="infoblockMenu" class="open active">--><!--<a href="#/pages"><i class="fa fa-file-text-o"></i><span data-i18n="Pages">Инфоблоки</span></a>--><!--<ul>--><!--<li--><!--ng-repeat="(pageName, page) in pages"--><!--ng-if="page.icon"--><!--ng-class="{\'active\': $root.activeEntity == page.entityName}">--><!--<a ui-sref="entitiesList({\'entity\': page.entityName})">--><!--<i class="fa {{page.icon}}"></i>--><!--<span data-i18n="PageNamePlaceHere">{{ page.title }}</span>--><!--</a>--><!--</li>--><!--</ul>--><!--</li>--><!--</ul>--><!--</div>--><div class=nav-wrapper ng-if=pages><ul id=nav class=nav data-slim-scroll data-collapse-nav data-highlight-active><li class="infoblockMenu open" ng-repeat="(pageName, page) in pages" ng-if=page.icon style="cursor: pointer"><a><i class="fa {{page.icon}}"></i> <span data-i18n=PageNamePlaceHere>{{ page.title }}</span></a><ul class=submenu><li ng-repeat="entity in page.entities" id={{entity.entityName}} ng-class="{\'active\': $root.activeEntity == entity.entityName}"><a ui-sref="entitiesList({\'entity\': entity.entityName})"><i class="fa {{entity.icon}}"></i> <span data-i18n=PageNamePlaceHere>{{ entity.title }}</span></a></li></ul></li></ul></div>'),e.put("app/components/pagination/pagination.html",'<footer class=table-footer><div class=row><div class="col-md-6 page-num-info"><span>Элементов на странице:&nbsp;<select data-ng-model=perPage data-ng-options="num.title for num in numPerPageOpt track by num.value" data-ng-change=onNumPerPageChange()></select><span>{{getCounter()}} из {{$parent.entityTotal}}</span></span></div><div class="col-md-6 text-right pagination-container scrollme" id=pagination ng-scrollable=scrollConfig><ul class="pagination-sm pagination"><!--<li ng-class="{disabled: noPrevious()}"><a ng-click="prevPage(true);" href="">Первая</a>--><!--</li>--><!--<li ng-class="{disabled: noPrevious()}"><a ng-click="prevPage();" href="">‹</a>--><!--</li>--><li ng-repeat="(pageId,page) in pagesCountList" ng-class="{active: isActive(pageId)}" ng-show=isInRange(pageId)><a ng-bind=page ng-click="goToPage(page - 1);" href=""></a></li><!--<li ng-class="{disabled: noNext()}"><a ng-click="nextPage();" href="">›</a></li>--><!--<li ng-class="{disabled: noNext()}"><a ng-click="nextPage(true);" href="">Последняя</a>--><!--</li>--></ul></div></div></footer>'),e.put("app/components/popup/popup.html",'<div class=modal-header><h3>Удаление</h3></div><div class=modal-body><span ng-if=title><strong>{{title}}</strong><br></span>{{ message }}</div><div class=modal-footer><button class="btn btn-primary" ng-click=ok()>Удалить</button> <button class="btn btn-warning" ng-click=cancel()>Отмена</button></div>'),e.put("app/components/siteHeader/siteHeader.html",'<header class="top-header clearfix"><!-- Logo --><div class=logo><a href=#/ ><!-- <span class="logo-icon glyphicon glyphicon-fire"></span> --> <span>ATOM</span></a></div><!-- needs to be put after logo to make it working--><div class=menu-button ng-click="$root.toggleCanvas = !$root.toggleCanvas"><span class=icon-bar></span> <span class=icon-bar></span> <span class=icon-bar></span></div><div class=top-nav><ul class="nav-right pull-right list-unstyled"><li class="dropdown text-normal nav-profile" uib-dropdown><a href=javascript:; class=dropdown-toggle uib-dropdown-toggle><span>{{$root.userName}}</span></a><ul class="dropdown-menu with-arrow pull-right"><li><a ui-sref=logout><i class="fa fa-sign-out"></i> <span data-i18n="Log Out">Выход</span></a></li></ul></li></ul></div></header>'),e.put("app/directives/atomGlobalPopup/atomGlobalPopup.html",'<div class=modal-header><h3 class=modal-title>Внимание!</h3></div><div class=modal-body><p>{{ errorMessage }}</p></div><div class=modal-footer><button class="btn btn-primary" type=button ng-click=closePopup()>Закрыть</button></div>'),e.put("app/directives/crmEntityFilter/crmEntityFilter.html",'<div class=form-inline ng-if="field.type==\'text\'||field.type==\'string\'"><input class=form-control type=text ng-model=fieldValue> <a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div><div ng-if="field.type==\'integer\'"><input type=text ng-model=fieldValue ng-keypress=applyFilter($event)> <a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div><div ng-if="field.type==\'datetime\'"><input type=text ng-model=fieldValue ng-keypress=applyFilter($event)> <a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div><div ng-if="field.type==\'boolean\'"><label class=switch><input type=checkbox ng-model=fieldValue><i></i></label><a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div><div ng-if="field.type==\'select\'"><input type=text ng-model=fieldValue ng-keypress=applyFilter($event)> <a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div><div ng-if="field.type==\'entity\'"><input type=text ng-model=fieldValue ng-keypress=applyFilter($event)> <a ng-click=applyFilter() class="btn-icon bg-success btn-icon-sm"><i class="fa fa-check"></i></a></div>'),e.put("app/modules/authorization/authorization.html",'<div class=page-signin><div class=signin-header><section class="logo text-center"><a href=#/ >ATOM</a></section></div><div class=main-body><div class=container><div class=form-container><form class=form-horizontal ng-submit=makeLogin() autocomplete=off><fieldset><input style=display:none> <input type=password style=display:none><div class=form-group><div class="btn-icon-lined btn-icon-round btn-icon-sm btn-default-light"><span class="glyphicon glyphicon-envelope"></span></div><input type=email class="form-control input-lg input-round text-center" placeholder=Email ng-model=user.email></div><div class=form-group><div class="btn-icon-lined btn-icon-round btn-icon-sm btn-default-light"><span class="glyphicon glyphicon-lock"></span></div><input type=password class="form-control input-lg input-round text-center" placeholder=Пароль ng-model=user.password></div><div class=form-group><label class="ui-checkbox rememberMeLabel"><input name=checkbox1 type=checkbox value=option2 ng-model=rememberMe> <span>Запомнить меня</span></label></div><div class=form-group><input type=submit class="btn btn-primary btn-lg btn-round btn-block text-center" value=Войти></div></fieldset></form></div></div></div></div>'),e.put("app/modules/dashboard/dashboard.html",""),e.put("app/modules/errorPage/500.html",'<div class=page-err><div class="err-container text-center"><div class=err><div class=err-inner><h1>500</h1><h2>Server Error</h2></div></div><div class=err-mss><p>{{$root.errorMessage}}</p></div><div class=err-body><a ui-sref=dashboard class="btn btn-lg btn-primary" ng-click=closeError()><span class="glyphicon glyphicon-home"></span> <span class=space></span> Вернуться на главную</a></div></div><!--     <div class="footer text-center">\r\n          Copyright 2014 {{main.brand}} Admin\r\n      </div> --></div>'),e.put("app/modules/infographic/infographic.html",'<div class=page><div ng-hide=scheme class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div><section class="panel panel-default"><div class=panel-heading><strong><span class="glyphicon glyphicon-th"></span>Формирование отчёта</strong></div><div class=panel-body><form class=form-horizontal autocomplete=off atom-form><input type=text style="position: absolute;left: -1000px"> <input type=password style="position: absolute;left: -1000px"><div class=row ng-if=showGraph><div class=col-md-12><div class="panel panel-default"><div class=panel-body><div atom-flot-chart flot-data=line1.data flot-options=line1.options style="width: 100%; height: 300px"></div><div id=legend></div></div></div></div></div><div class=form-group ng-repeat="(itemName, item) in scheme"><label class=col-sm-2 for="{{ itemName }}">{{ item.title }} <span class=require>*</span></label><div class=col-sm-10 ng-if="item.type === \'string\'" atom-field-string field=entity[itemName] field-name=itemName scheme=item></div><div class=col-sm-10 ng-if="item.type === \'password\'" atom-field-password field=entity[itemName] field-name=itemName scheme=item></div><div class=col-sm-10 ng-if="item.type === \'boolean\'" atom-field-boolean field=entity[itemName] field-name=itemName scheme=item></div><div class=col-sm-10 ng-if="item.type === \'entity\'" atom-field-entity field=entity[itemName] field-name=itemName linked-entity=linkedEntities[item.entity.model] entity-model=entityModels scheme=item></div><div class=col-sm-10 ng-if="item.type === \'select\'" atom-field-select field=entity[itemName] field-name=itemName entity-model=entityModels scheme=item></div><div class=col-sm-10 ng-if="item.type === \'date\' || item.type === \'time\' || item.type === \'datetime\'" atom-field-datetime field=entity[itemName] field-name=itemName scheme=item></div><div style="clear: both; margin-bottom: 10px"></div></div><div class=form-group><div class=col-sm-2></div><div class=col-sm-10><div class=pull-right><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button type=button ng-click=goToList() class="btn btn-warning">Отменить</button></div></div><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button ng-click=getGiagram() type=button class="btn btn-primary">Сформировать</button></div></div></div></form></div></section></div>'),e.put("app/directives/atomFields/atomFieldBoolean/atomFieldBoolean.html",'<div class=input-group><div class=col-sm-10><label class=switch><input type=checkbox id="{{ itemName }}" ng-model=field><i></i></label></div></div>'),e.put("app/directives/atomFields/atomFieldDatetime/atomFieldDatetime.html","<div class=input-group><input type=text class=form-control id={{fieldName}} name={{fieldName}} ng-model=field ng-disabled=scheme.disabled> <span class=input-group-addon><i class=fa ng-class=\"{\r\n        'fa-calendar': (scheme.type === 'date' || scheme.type === 'datetime'),\r\n        'fa-clock-o':  scheme.type === 'time'\r\n        }\"></i></span></div>"),e.put("app/directives/atomFields/atomFieldEntity/atomFieldEntity.html",'<select ng-if=scheme.multiple chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" multiple ng-options="b as b.title for b in list track by b.id" ng-model=entityModel[fieldName] ng-change=triggerEvent()><option value=""></option></select><select ng-if=!scheme.multiple chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" ng-options="b as b.title for b in list track by b.id" ng-model=entityModel[fieldName] ng-change=triggerEvent()><option value=""></option></select>'),e.put("app/directives/atomFields/atomFieldHtml/atomFieldHtml.html",'<div ng-class="{\'input-group\': postButton}"><textarea autocomplete=off id="{{ itemName }}" placeholder="" ui-tinymce=tinymceOptions class=form-control ng-model=field></textarea><span ng-if=postButton class="input-group-btn input-group-btn-fucked-correction" ng-click=postButtonAction()><button class="btn btn-default" type=button><i class="fa fa-filter"></i></button></span></div>'),e.put("app/directives/atomFields/atomFieldNumeric/atomFieldNumeric.html",'<div ng-class="{\'input-group\': postButton}"><input ui-mask={{scheme.mask}} autocomplete=off id="{{ itemName }}" ng-disabled=scheme.disabled placeholder="" type=number class=form-control ng-model=field> <span ng-if=postButton class="input-group-btn input-group-btn-fucked-correction" ng-click=postButtonAction()><button class="btn btn-default" type=button><i class="fa fa-filter"></i></button></span></div>'),e.put("app/directives/atomFields/atomFieldPassword/atomFieldPassword.html",'<div class=input-group><input id="{{ itemName }}" autocomplete=off type="{{ atomPassword.type }}" class=form-control ng-model=field> <span class=input-group-addon ng-click=atomPassword.generatePassword()><i class="glyphicon glyphicon-flash"></i></span></div>'),e.put("app/directives/atomFields/atomFieldSelect/atomFieldSelect.html",'<select ng-if=scheme.multiple chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" multiple ng-options="b as b.title for b in list track by b.id" ng-model=entityModel[fieldName]><option value=""></option></select><select ng-if=!scheme.multiple chosen no_results_text="\'Результат не найден\'" placeholder-text-multiple="\'Выберите один или несколько вариантов\'" placeholder-text-single="\'Выберите один вариант\'" ng-options="b as b.title for b in list track by b.id" ng-model=entityModel[fieldName]><option value=""></option></select>'),e.put("app/directives/atomFields/atomFieldString/atomFieldString.html",'<div ng-class="{\'input-group\': postButton}"><input ui-mask={{scheme.mask}} autocomplete=off id="{{ itemName }}" ng-disabled=scheme.disabled placeholder="" type=text class=form-control ng-model=field> <span ng-if=postButton class="input-group-btn input-group-btn-fucked-correction" ng-click=postButtonAction()><button class="btn btn-default" type=button><i class="fa fa-filter"></i></button></span></div>'),e.put("app/directives/crmEntityFilter/templates/booleanFilter.html",'<div class=form-inline ng-if="field.type==\'boolean\'"><div atom-field-boolean field=model.fieldValue field-name=fieldKey scheme=field style="display: inline-block"></div><a ng-click=applyFilter() class="btn-icon bg-info btn-icon-sm"><i class="fa fa-check"></i></a></div>'),e.put("app/directives/crmEntityFilter/templates/datetimeFilter.html",'<div class=form-inline><div class=datepicker-holder atom-field-datetime field=model.fieldValue field-name=fieldKey scheme=field></div><a ng-hide=true ng-click=applyFilter() class="btn-icon bg-info btn-icon-sm"><i class="fa fa-check"></i></a><div class=secondaryValue atom-field-datetime ng-i-f=interval field=model.secondaryValue field-name=fieldKey scheme=field interval=true></div><a ng-hide=true ng-click="interval?interval=false:interval=true" class="btn-icon bg-info btn-icon-sm"><i class="fa fa-arrows-h"></i></a></div>'),e.put("app/directives/crmEntityFilter/templates/entityFilter.html","<div class=form-inline><div atom-field-entity field=model.fieldValue field-name=fieldKey scheme=scheme entity-model=entityModel linked-entity=linkedEntities[fieldKey]></div></div>"),e.put("app/directives/crmEntityFilter/templates/integerFilter.html",'<div class=form-inline ng-if="field.type==\'integer\'"><input id=ef1 class=form-control type=number ng-model=model.fieldValue ng-blur="applyFilter(model.fieldValue, model.secondaryValue)"> <input id=ef2 class=form-control type=number ng-model=model.secondaryValue ng-blur="applyFilter(model.fieldValue, model.secondaryValue)"> <a ng-click="applyFilter(fieldValue, secondaryValue)" class="btn-icon bg-success btn-info -sm"><i class="fa fa-check"></i> </a><!--<a ng-click="applyInterval(fieldValue, secondaryValue)" class="btn-icon bg-info btn-icon-sm">--><!--<i class="fa fa-arrows-h"></i>--><!--</a>--></div>'),e.put("app/directives/crmEntityFilter/templates/selectFilter.html",'<div ng-if="field.type==\'select\'"><div atom-field-select field=model.fieldValue field-name=fieldKey scheme=field entity-model=entityModel style="display: inline-block"></div><a ng-click=applyFilter() class="btn-icon bg-info -sm"><i class="fa fa-check"></i></a></div>'),e.put("app/directives/crmEntityFilter/templates/stringFilter.html","<div class=form-inline><div atom-field-string field=model.fieldValue field-name=fieldKey scheme=field post-button=true post-button-action=applyFilter></div></div>"),e.put("app/modules/entityPage/entitiesList/entitiesList.html",'<div class=page style="position: relative"><section ng-show=isRendered() class="panel panel-default table-dynamic"><div style="position: relative" class="panel-heading text-right"><div id=table-title style="position: absolute; left: 10px; top: 20px; font-weight: 600" data-ng-bind=tableTitle></div><button tooltip="График статистики" tooltip-placement=top tooltip-append-to-body=true ng-show=graphicsEnabled class="btn btn-success btn-w-md listControlButtons" type=button ng-click=goToGraphic()>Статистика</button> <button tooltip="Добавить новый элемент" tooltip-placement=top tooltip-append-to-body=true ng-show=createEnabled class="btn btn-success btn-w-md listControlButtons" type=button ng-click=new()>Добавить</button><!--go(,true);--> <button tooltip="Экспорт элементов в XLS" tooltip-placement=top tooltip-append-to-body=true ng-show=exportEnabled class="btn btn-primary btn-w-md listControlButtons" ng-click=exportStack(); type=button>Выгрузить</button> <button tooltip="Удалить выбранные элементы" tooltip-placement=top tooltip-append-to-body=true ng-show=deleteEnabled ng-disabled=isSelectItems(); class="btn btn-danger btn-w-md listControlButtons" ng-click=deleteStack(); type=button>Удалить</button> <button type=button tooltip="Сбросить фильтры записей" tooltip-placement=top tooltip-append-to-body=true ng-if=filtered ng-click=resetFilter() class="btn btn-warning pull-right list-control-buttons">Сбросить фильтр</button><form method=post id=downloadForm></form></div><div data-ng-show="list.scheme && hasSearchFields" class=table-filters><div class=row><div class="col-sm-4 col-xs-6"><form class="ng-scope ng-pristine ng-valid"><div class=input-group><input type=text placeholder=Поиск... class="form-control ng-pristine ng-valid" ng-model=searchKeywords ng-keyup=keyUpHandler($event) ng-class="{\'input-danger\': searchKeywordsError}"> <span class=input-group-addon ng-click=search()><i class="fa fa-search"></i></span></div><input type=hidden value="" id=hidden-q></form></div><!--<div class="col-sm-3 col-xs-6 filter-result-info">\r\n            <span>\r\n                Showing {{filteredStores.length}}/{{stores.length}} entries\r\n            </span>\r\n        </div>--></div></div><div class=panel-body><section class=table-flip-scroll><table id=table-{{model}} class="table table-bordered table-striped cf"><thead class=cf><tr><th style="padding-left: 10px; height: 41px" class=checkAll-th><div class=th style="padding-left: 0px;padding-right: 0px"><label style="margin-right: 0" class=ui-checkbox><input class=remAll type=checkbox value="" data-ng-click=selectAllItems($event);> <span></span></label></div></th><th style="height: 41px; min-width: 150px" ng-repeat="(fieldKey, field) in fieldsInTable track by $index" ng-if="field.sort && fieldKey !== \'enabled\' "><div class=th ng-show=!editMode[fieldKey]>{{field.title}} <span class=arrows-sort><span ng-show=field.sort class="fa fa-angle-up" ng-click=" order(fieldKey,-1) " ng-class="{active: curSortField == fieldKey && curSortOrder == -1 }"></span> <span ng-show=field.sort class="fa fa-angle-down" ng-click=" order(fieldKey,1) " ng-class="{active: curSortField == fieldKey && curSortOrder == 1 }"></span> <i ng-click=showFilter(fieldKey) class="fa fa-filter"></i></span></div><div class=th ng-show=editMode[fieldKey] ng-if="editMode[fieldKey] || onceSelected[fieldKey]"><crm-entity-filter></crm-entity-filter><span class=close-filter><i ng-click=resetFilterByKey(fieldKey) class="fa fa-times"></i></span></div></th><th style="height: 41px" ng-if="list.scheme.enabled && list.scheme.enabled.sort"><div class=th>Доступность <span class=arrows-sort><span class="fa fa-angle-up" ng-click=" order(\'enabled\',-1) " ng-class="{active: curSortField == \'enabled\' && curSortOrder == -1 }"></span> <span class="fa fa-angle-down" ng-click=" order(\'enabled\',1) " ng-class="{active: curSortField == \'enabled\' && curSortOrder == 1 }"></span></span></div></th><th style="height: 41px" class=action-th><div class=th>Действия</div></th></tr></thead><tbody><tr ng-repeat="item in renderData track by $index" ng-init="last.row = $last"><td style="height: 41px" class=testx style="width: 15px; padding-left: 10px; padding-right: 0px"><label style="margin-right: 0" class=ui-checkbox><input class=remBox type=checkbox value="{{ item._id.$id }}" ng-click=updateRemItems($event);> <span></span></label></td><td class=fieldCell style="height: 41px" list-wrapp={{item[fieldKey]}} ng-repeat-start="(fieldKey, field) in fieldsInTable track by $index" ng-if="list.scheme[fieldKey].type !== \'boolean\'" entity-list-markup is-last="topLast && $first" entity=item[fieldKey] entity-name=fieldKey field=field>{{::item[fieldKey]}}</td><td style="height: 41px" class=visible-td ng-repeat-end ng-if="list.scheme[fieldKey].type == \'boolean\'"><!--<label class="switch"  data-atom-toggle-visible="" data-model="{{model}}" data-id="{{itemId|ObjectKey:list.data}}" >--><label class=switch data-atom-toggle-visible="" data-model={{model}} data-id={{itemId}}><input type=checkbox data-ng-model=item[fieldKey] ng-change="setEdited(item, fieldKey)"> <i class=slim></i></label></td><td style="height: 41px" class=visible-td ng-if=list.scheme.enabled><!--<label class="switch"  data-atom-toggle-visible="" data-model="{{model}}" data-id="{{itemId|ObjectKey:list.data}}" >--><label class=switch data-atom-toggle-visible="" data-model={{model}} data-id={{itemId}}><input type=checkbox data-ng-model=item.enabled ng-change=setEdited(item)> <i class=slim></i></label></td><td style="height: 41px; min-width: 85px" class=action-td><a tooltip="Просмотр и редактирование элемента" tooltip-placement=left tooltip-append-to-body=true class="btn-icon btn-icon-min-sm btn-edit" ui-sref="entityEdit({ entity: model, id: item._id.$id })"><i ng-if=editEnabled class="glyphicon glyphicon-pencil"></i> <i ng-if=!editEnabled class="fa fa-th-list"></i> </a><!--<a class="btn-icon btn-icon-min-sm btn-remove cursor-pointer" data-rem-id="{{itemId|ObjectKey:list.data}}" data-ng-click="delete($event);">--> <a tooltip="Удалить элемент" tooltip-placement=left tooltip-append-to-body=left ng-show=deleteEnabled class="btn-icon btn-icon-min-sm btn-remove cursor-pointer" data-rem-id={{itemId}} data-ng-click="deleteStack(item._id[\'$id\']);"><i class="glyphicon glyphicon-trash"></i></a></td></tr></tbody></table></section></div><atom-pagination data-ng-show=isRendered()></atom-pagination></section><div data-ng-hide=isRendered() class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div></div>'),
e.put("app/modules/entityPage/entityEdit/entityEdit.html",'<div class=page style="position: relative"><section ng-show=formSchema class="panel panel-default"><div class=panel-heading><strong data-ng-show=isNew><span class="glyphicon glyphicon-th"></span> Создание элемента</strong> <strong data-ng-hide=isNew><span class="glyphicon glyphicon-th"></span> Редактирование элемента <span ng-if=itemTitle>"<span class=edit-item-title>{{itemTitle}}</span>"</span></strong></div><div class=panel-body><div class=row><div class=ui-tab-container ng-if="tabsCount > 1"><tabset class=ui-tab><tab heading={{tabTitle}} ng-repeat="(tabKey, tabTitle) in tabs"><form class=form-horizontal autocomplete=off><input type=text style=display:none id=email name=email> <input type=password style=display:none id=password name=password><div class=form-group ng-if="field.tab === tabKey" ng-show="field.visible !== false" ng-repeat="(key,field) in formSchema" build-form-markup="" markup-data={{field}} field-readonly="{{isNew ? !createEnabled : !updateEnabled}}"></div><div class="form-group edit-buttons"><div class=col-sm-2></div><div class=col-sm-10><div class=pull-right><!--<a  class="btn btn-w-md btn-gap-v btn-warning">Отмена</a>--><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button type=button ng-click=goToList() class="btn btn-warning">Отменить</button> <button type=button class="btn btn-warning dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><li><a href=javascript:; ng-click=rollback();>Отменить изменения</a></li><li><a ui-sref="entitiesList({\'entity\': entity })">Вернуться к списку</a></li></ul></div></div><div ng-if=deleteEnabled class="btn-group dropup pull-right margin-right-10" ng-show=!isNew uib-dropdown><button type=button ng-click=remove() class="btn btn-danger">Удалить</button> <button type=button class="btn btn-danger dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=clear();>Очистить форму</a></li><li><a href=javascript:; ng-click=remove();>Удалить запись</a></li></ul></div><button ng-show=!deleteEnabled class="btn btn-danger pull-right margin-right-10 btn-w-md listControlButtons" ng-click=clear(); type=button>Очистить форму</button><div ng-if=updateEnabled class="btn-group dropup pull-right margin-right-10" uib-dropdown><button ng-click=save(true) type=button class="btn btn-primary">Сохранить</button> <button type=button class="btn btn-primary dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=save(true);close()>Сохранить и вернуться к списку</a></li><li><a href=javascript:; ng-click=save(false);>Сохранить и остаться</a></li></ul></div></div></div></form></tab></tabset></div></div><form ng-if="tabsCount === 1" class=form-horizontal autocomplete=off><input type=text style="position: absolute;left: -1000px"> <input type=password style="position: absolute;left: -1000px"><div class=form-group ng-show="field.visible !== false" ng-repeat="(key,field) in formSchema" build-form-markup="" markup-data={{field}} field-data={{form[key][0].route}} field-readonly="{{isNew ? !createEnabled : !updateEnabled}}"></div><div class=form-group><div class=col-sm-2></div><div class=col-sm-10><div class=pull-right><!--<a  class="btn btn-w-md btn-gap-v btn-warning">Отмена</a>--><div class="btn-group dropup pull-right margin-right-10" uib-dropdown><button type=button ng-click=goToList() class="btn btn-warning">Отменить</button> <button ng-show=updateEnabled type=button class="btn btn-warning dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul ng-show=updateEnabled class="dropdown-menu pull-right"><li><a href=javascript:; ng-click=rollback();>Отменить изменения</a></li><li><a ui-sref="entitiesList({\'entity\': entity })">Вернуться к списку</a></li></ul></div></div><div ng-show=deleteEnabled class="btn-group dropup pull-right margin-right-10" ng-show=!isNew uib-dropdown><button type=button ng-click=remove() class="btn btn-danger">Удалить</button> <button type=button class="btn btn-danger dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=clear();>Очистить форму</a></li><li><a href=javascript:; ng-click=remove();>Удалить элемент</a></li></ul></div><div ng-if="isNew ? createEnabled : updateEnabled" class="btn-group dropup pull-right margin-right-10" uib-dropdown><button ng-click=save(true) type=button class="btn btn-primary">Сохранить</button> <button type=button class="btn btn-primary dropdown-toggle" uib-dropdown-toggle><span class=caret></span> <span class=sr-only>Toggle Dropdown</span></button><ul class="dropdown-menu pull-right"><!--<li><a href="javascript:;">Предварительный просмотр</a></li>--><li><a href=javascript:; ng-click=save(true);close()>Сохранить и вернуться к списку</a></li><li><a href=javascript:; ng-click=save(false);>Сохранить и остаться</a></li></ul></div></div></div></form></div></section><div ng-hide=formSchema class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div></div>'),e.put("app/modules/entityPage/pagesList/items_renderer.html",'<div ng-init="hovered = false" ng-mouseover=hoverIn(this); ng-mouseleave=hoverOut(this) ng-class="{\'angular-ui-tree-handle\': item.isRoot === false}" ng-attr-data-nodrag="{{item.isRoot === true}}" class=angular-ui-tree-handle-nodrag><span data-ng-show="item.items.length > 0"><a class=angular-ui-tree-icon data-nodrag ng-click=toggle(this)><span class=angular-ui-tree-icon-collapse ng-class="{\'collapsed\': collapsed, \'uncollapsed\': !collapsed}"></span> </a></span>{{item.title}} <a ng-show=hovered ng-if=!item.isRoot class="pull-right btn-icon btn-icon-min-sm btn-danger" data-nodrag ng-click="removeItem(item, remove)" href=javascript:void(0)><i class="glyphicon glyphicon-trash"></i> </a><a ng-show=hovered ng-if=!item.isRoot class="pull-right btn-icon btn-icon-min-sm btn-edit" data-nodrag ui-sref="entityEdit({ entity: \'page\', id: item._id.$id })"><i class="glyphicon glyphicon-pencil"></i> </a><a ng-show=hovered class="pull-right btn-icon btn-icon-min-sm btn-success" data-nodrag ui-sref="entityAddPage({ entity: \'page\', pid: item._id.$id })"><i class="glyphicon glyphicon-plus"></i></a></div><ol ui-tree-nodes=options ng-model=item.items ng-class="{hidden: collapsed}"><li ng-repeat="item in item.items" ui-tree-node ng-include="\'app/modules/entityPage/pagesList/items_renderer.html\'"></li></ol>'),e.put("app/modules/entityPage/pagesList/pagesList.html",'<div class="page page-table" style="position: relative"><section ng-show=list.scheme class="panel panel-default"><div class=panel-heading><strong><span class="glyphicon glyphicon-th"></span> Текстовые страницы</strong></div><div class=panel-body><div ui-tree=options><ol ui-tree-nodes ng-model=data data-nodrop-enabled><li ng-repeat="item in data" ui-tree-node ng-include="\'app/modules/entityPage/pagesList/items_renderer.html\'"></li></ol></div></div></section><div ng-hide=list.scheme class="form-group refresh-position"><div class="col-md-12 text-center"><span style="font-size: 24px" class="glyphicon glyphicon-refresh glyphicon-refresh-animate"></span></div></div></div>')}]);